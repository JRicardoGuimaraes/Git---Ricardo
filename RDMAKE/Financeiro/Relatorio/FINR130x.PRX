#INCLUDE "FINR130.CH"
#INCLUDE "PROTHEUS.CH"
/*/
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡„o	 ³ FINR130x³ Autor ³ Paulo Boschetti	     ³ Data ³ 01.06.92 ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡„o ³ Posi‡„o dos Titulos a Receber 						 	  		  ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Sintaxe e ³ FINR130(void)										  					  ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso		 ³ Generico 												  				  ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±³ Alterado por: Marcelo Aguiar Pimentel                                 Ù±±
±±³ Data........: 22/01/2007											  Ù±±
±±³ Motivo......: A impressão das filias sera concentrado no mesmo dia e nao Ù±±
±±³               em cada filial											Ù±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
/*/
User Function FINR13x()
Local cDesc1 :=OemToAnsi(STR0001)  //"Imprime a posi‡„o dos titulos a receber relativo a data ba-"
Local cDesc2 :=OemToAnsi(STR0002)  //"se do sistema."
Local cDesc3 :=""
Local wnrel
Local cString:="SE1"
Local nRegEmp:=SM0->(RecNo())
Local dOldDtBase := dDataBase
Local dOldData	:= dDatabase

Private titulo  :=""
Private cabec1  :=""
Private cabec2  :=""
Private cBkFilial
Private aSRes:={}
Private aGrupo
Private cGrupo := ""
Private nIndGrp
Private aSResA:={}
Private aLinha  :={}
Private aReturn :={ OemToAnsi(STR0003), 1,OemToAnsi(STR0004), 1, 2, 1, "",1 }  //"Zebrado"###"Administracao"
Private cPerg	 :="GFI130"
Private nJuros  :=0
Private nLastKey:=0
Private nomeprog:="GFINR130"
Private tamanho :="G"
Private lTMes:=.f.
//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Defini‡„o dos cabe‡alhos ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
titulo := OemToAnsi(STR0005)  //"Posicao dos Titulos a Receber"
cabec1 := OemToAnsi(STR0006)  //"Codigo Nome do Cliente      Prf-Numero         TP  Natureza    Data de  Vencto   Vencto  Banco  Valor Original |        Titulos Vencidos          | Titulos a Vencer | Num        Vlr.juros ou  Dias   Historico     "
cabec2 := OemToAnsi(STR0007)  //"                            Parcela                            Emissao  Titulo    Real                         |  Valor Nominal   Valor Corrigido |   Valor Nominal  | Banco       permanencia  Atraso               "

//Nao retire esta chamada. Verifique antes !!!
//Ela é necessaria para o correto funcionamento da pergunte 36 (Data Base)
AjustaSx1()
PutDtBase()

pergunte(cPerg,.F.)

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Variaveis utilizadas para parametros												³
//³ mv_par01		 // Do Cliente 													   ³
//³ mv_par02		 // Ate o Cliente													   ³
//³ mv_par03		 // Do Prefixo														   ³
//³ mv_par04		 // Ate o prefixo 												   ³
//³ mv_par05		 // Do Titulo													      ³
//³ mv_par06		 // Ate o Titulo													   ³
//³ mv_par07		 // Do Banco														   ³
//³ mv_par08		 // Ate o Banco													   ³
//³ mv_par09		 // Do Vencimento 												   ³
//³ mv_par10		 // Ate o Vencimento												   ³
//³ mv_par11		 // Da Natureza														³
//³ mv_par12		 // Ate a Natureza													³
//³ mv_par13		 // Da Emissao															³
//³ mv_par14		 // Ate a Emissao														³
//³ mv_par15		 // Qual Moeda															³
//³ mv_par16		 // Imprime provisorios												³
//³ mv_par17		 // Reajuste pelo vecto												³
//³ mv_par18		 // Impr Tit em Descont												³
//³ mv_par19		 // Relatorio Anal/Sint												³
//³ mv_par20		 // Consid Data Base?  												³
//³ mv_par21		 // Consid Filiais  ?  												³
//³ mv_par22		 // da filial													      ³
//³ mv_par23		 // a flial 												         ³
//³ mv_par24		 // Da loja  															³
//³ mv_par25		 // Ate a loja															³
//³ mv_par26		 // Consid Adiantam.?												³
//³ mv_par27		 // Da data contab. ?												³
//³ mv_par28		 // Ate data contab.?												³
//³ mv_par29		 // Imprime Nome    ?												³
//³ mv_par30		 // Outras Moedas   ?												³
//³ mv_par31       // Imprimir os Tipos												³
//³ mv_par32       // Nao Imprimir Tipos												³
//³ mv_par33       // Abatimentos  - Lista/Nao Lista/Despreza					³
//³ mv_par34       // Consid. Fluxo Caixa												³
//³ mv_par35       // Salta pagina Cliente											³
//³ mv_par36       // Data Base													      ³
//³ mv_par37       // Compoe Saldo por: Data da Baixa, Credito ou DtDigit  ³
//³ MV_PAR38       // Tit. Emissao Futura												³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Envia controle para a fun‡„o SETPRINT ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ

wnrel:="GFINR130"            //Nome Default do relatorio em Disco
aOrd :={	OemToAnsi(STR0008),;	//"Por Cliente"
	OemToAnsi(STR0009),;	//"Por Prefixo/Numero"
	OemToAnsi(STR0010),; //"Por Banco"
	OemToAnsi(STR0011),;	//"Por Venc/Cli"
	OemToAnsi(STR0012),;	//"Por Natureza"
	OemToAnsi(STR0013),; //"Por Emissao"
	OemToAnsi(STR0014),;	//"Por Ven\Bco"
	OemToAnsi(STR0015),; //"Por Cod.Cli."
	OemToAnsi(STR0016),; //"Banco/Situacao"
	OemToAnsi(STR0047),; //"Por Numero/Tipo/Prefixo"
	"Por Grupo"}

wnrel:=SetPrint(cString,wnrel,cPerg,@titulo,cDesc1,cDesc2,cDesc3,.F.,aOrd,,Tamanho)

If nLastKey == 27
	Return
Endif

SetDefault(aReturn,cString)

If nLastKey == 27
	Return
Endif

RptStatus({|lEnd| FA130Imp(@lEnd,wnRel,cString)},titulo)  // Chamada do Relatorio

SM0->(dbGoTo(nRegEmp))
cFilAnt := SM0->M0_CODFIL

//Acerta a database de acordo com a database real do sistema
If mv_par20 == 1    // Considera Data Base
	dDataBase := dOldDtBase
Endif	

Return

/*/
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡„o	 ³ FA130Imp ³ Autor ³ Paulo Boschetti		  ³ Data ³ 01.06.92 ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡„o ³ Imprime relat¢rio dos T¡tulos a Receber						  ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Sintaxe e ³ FA130Imp(lEnd,WnRel,cString)										  ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Parametros³ lEnd	  - A‡Æo do Codeblock				    					  ³±±
±±³			 ³ wnRel   - T¡tulo do relat¢rio 									  ³±±
±±³			 ³ cString - Mensagem													  ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso		 ³ Generico 																  ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
/*/
Static Function FA130Imp(lEnd,WnRel,cString)
Local CbCont
Local CbTxt
Local nOrdem
Local lContinua := .T.
Local cCond1,cCond2,cCarAnt
Local nTit0:=0
Local nTit1:=0
Local nTit2:=0
Local nTit3:=0
Local nTit4:=0
Local nTit5:=0
Local nTotJ:=0
Local nTot0:=0
Local nTot1:=0
Local nTot2:=0
Local nTot3:=0
Local nTot4:=0
Local nTotTit:=0
Local nTotJur:=0
Local nTotFil0:=0
Local nTotFil1:=0
Local nTotFil2:=0
Local nTotFil3:=0
Local nTotFil4:=0
Local nTotFilTit:=0
Local nTotFilJ:=0
Local nAtraso:=0
Local nTotAbat:=0
Local nSaldo:=0
Local dDataReaj
Local dDataAnt := dDataBase
Local lQuebra
Local nMesTit0 := 0
Local nMesTit1 := 0
Local nMesTit2 := 0
Local nMesTit3 := 0
Local nMesTit4 := 0
Local nMesTTit := 0
Local nMesTitj := 0
Local cIndexSe1
Local cChaveSe1
Local nIndexSE1
Local dDtContab
Local cTipos  := ""
#IFDEF TOP
	Local aStru := SE1->(dbStruct()), ni
#ENDIF	
Local nTotsRec := SE1->(RecCount())
Local aTamCli  := TAMSX3("E1_CLIENTE")
Local lF130Qry := ExistBlock("GFI130QRY")//ExistBlock("F130QRY")
// variavel  abaixo criada p/pegar o nr de casas decimais da moeda
Local ndecs := Msdecimais(mv_par15)
Local nAbatim := 0
Local nDescont:= 0
Private nRegSM0 := SM0->(Recno())
Private nAtuSM0 := SM0->(Recno())
PRIVATE dBaixa := dDataBase
PRIVATE cFilDe,cFilAte

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Ponto de entrada para Filtrar os tipos sem entrar na tela do ³
//³ FINRTIPOS(), localizacao Argentina.                          ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄJose Lucas, Localiza‡”es ArgentinaÄÙ
IF EXISTBLOCK("F130FILT")
	cTipos	:=	EXECBLOCK("F130FILT",.f.,.f.)
ENDIF

nOrdem:=aReturn[8]
cMoeda:=Str(mv_par15,1)

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Vari veis utilizadas para Impress„o do Cabe‡alho e Rodap‚ ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
cbtxt 	:= OemtoAnsi(STR0046)
cbcont	:= 1
// li 		:= 80 
li 		:= 90 // Por Ricardo
m_pag 	:= 1

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ POR MAIS ESTRANHO QUE PARE€A, ESTA FUNCAO DEVE SER CHAMADA AQUI! ³
//³                                                                  ³
//³ A fun‡„o SomaAbat reabre o SE1 com outro nome pela ChkFile para  ³
//³ efeito de performance. Se o alias auxiliar para a SumAbat() n„o  ³
//³ estiver aberto antes da IndRegua, ocorre Erro de & na ChkFile,   ³
//³ pois o Filtro do SE1 uptrapassa 255 Caracteres.                  ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
SomaAbat("","","","R")

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Atribui valores as variaveis ref a filiais                ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
If mv_par21 == 2
	cFilDe  := cFilAnt
	cFilAte := cFilAnt
ELSE
	cFilDe := mv_par22	// Todas as filiais
	cFilAte:= mv_par23
Endif

//Acerta a database de acordo com o parametro
If mv_par20 == 1    // Considera Data Base
	dDataBase := mv_par36
Endif

dbSelectArea("SM0")
dbSeek(cEmpAnt+cFilDe,.T.)

nRegSM0 := SM0->(Recno())
nAtuSM0 := SM0->(Recno())

//While !Eof() .and. M0_CODIGO == cEmpAnt .and. M0_CODFIL <= cFilAte


	dbSelectArea("SE1")
//	cFilAnt := SM0->M0_CODFIL
	Set Softseek On

	If mv_par19 == 1
		titulo := titulo + OemToAnsi(STR0026)  //" - Analitico"
	Else
		titulo := titulo + OemToAnsi(STR0027)  //" - Sintetico"
//		cabec1 := OemToAnsi(STR0044)  //"                                                                                                               |        Titulos Vencidos          | Titulos a Vencer |            Vlr.juros ou             (Vencidos+Vencer)"
//		cabec2 := OemToAnsi(STR0045)  //"                                                                                                               |  Valor Nominal   Valor Corrigido |   Valor Nominal  |             permanencia                              "
	EndIf
	
	#IFDEF TOP
		
		If nOrdem = 1
			cQuery := ""
			aEval(SE1->(DbStruct()),{|e| If(!Alltrim(e[1])$"E1_FILIAL#E1_NOMCLI#E1_CLIENTE#E1_LOJA#E1_PREFIXO#E1_NUM#E1_PARCELA#E1_TIPO", cQuery += ","+AllTrim(e[1]),Nil)})
			cQuery := "SELECT E1_FILIAL, E1_NOMCLI, E1_CLIENTE, E1_LOJA, E1_PREFIXO, E1_NUM,E1_PARCELA, E1_TIPO, "+ SubStr(cQuery,2)
		Else
			cQuery := "SELECT * "
		EndIf
		
		cQuery += "  FROM "+	RetSqlName("SE1") + " SE1"
//		cQuery += " WHERE E1_FILIAL = '" + xFilial("SE1") + "'"
//		cQuery += "   AND D_E_L_E_T_ <> '*' "
		cQuery += " WHERE E1_FILIAL BETWEEN '" + cFilDe + "' AND '"+cFilAte+"' "
		Do Case
		   Case mv_par39 = 1  //RDVM
		        cQuery += "AND (SUBSTRING(E1_CCONT,2,2) = '01' OR SUBSTRING(E1_CCONT,2,2) = '02') " 		   
		   Case mv_par39 = 2 //ADUANA 
    		    cQuery += "AND SUBSTRING(E1_CCONT,2,2) = '21'  " 		   
		   Case mv_par39 = 3 //ILI
		        cQuery += "AND SUBSTRING(E1_CCONT,2,2) = '11' " 		   
		   Case mv_par39 = 4  //RMA
		        cQuery += "AND ( SUBSTRING(E1_CCONT,2,2) = '22' OR SUBSTRING(E1_CCONT,2,2) = '23') " 		   
		EndCase				

	#ENDIF
	
	IF nOrdem = 1
		cChaveSe1 := "E1_FILIAL+E1_NOMCLI+E1_CLIENTE+E1_LOJA+E1_PREFIXO+E1_NUM+E1_PARCELA+E1_TIPO"
		#IFDEF TOP
			cOrder := SqlOrder(cChaveSe1)
		#ELSE
			cIndexSe1 := CriaTrab(nil,.f.)
			IndRegua("SE1",cIndexSe1,cChaveSe1,,u_Fr130IndR(),OemToAnsi(STR0022))
			nIndexSE1 := RetIndex("SE1")
			dbSetIndex(cIndexSe1+OrdBagExt())
			dbSetOrder(nIndexSe1+1)
			dbSeek(xFilial("SE1"))
		#ENDIF
		cCond1 := "E1_CLIENTE <= mv_par02"
		cCond2 := "E1_CLIENTE + E1_LOJA"
		titulo := titulo + OemToAnsi(STR0017)  //" - Por Cliente"
		
	Elseif nOrdem = 2
		SE1->(dbSetOrder(1))
		#IFNDEF TOP
			dbSeek(cFilial+mv_par03+mv_par05)
		#ELSE
			cOrder := SqlOrder(IndexKey())
		#ENDIF
		cCond1 := "E1_NUM <= mv_par06"
		cCond2 := "E1_NUM"
		titulo := titulo + OemToAnsi(STR0018)  //" - Por Numero"
	Elseif nOrdem = 3
		SE1->(dbSetOrder(4))
		#IFNDEF TOP
			dbSeek(cFilial+mv_par07)
		#ELSE
			cOrder := SqlOrder(IndexKey())
		#ENDIF
		cCond1 := "E1_PORTADO <= mv_par08"
		cCond2 := "E1_PORTADO"
		titulo := titulo + OemToAnsi(STR0019)  //" - Por Banco"
	Elseif nOrdem = 4
		SE1->(dbSetOrder(7))
		#IFNDEF TOP
			dbSeek(cFilial+DTOS(mv_par09))
		#ELSE
//			cOrder := SqlOrder(IndexKey())
			cOrder:="E1_VENCREA,E1_FILIAL,E1_CLIENTE,E1_LOJA,E1_NOMCLI,E1_PREFIXO,E1_NUM,E1_PARCELA"
		#ENDIF
		cCond1 := "E1_VENCREA <= mv_par10"
		cCond2 := "E1_VENCREA"
		titulo := titulo + OemToAnsi(STR0020)  //" - Por Data de Vencimento"
	Elseif nOrdem = 5
		SE1->(dbSetOrder(3))
		#IFNDEF TOP
			dbSeek(cFilial+mv_par11)
		#ELSE
			cOrder := SqlOrder(IndexKey())
		#ENDIF
		cCond1 := "E1_NATUREZ <= mv_par12"
		cCond2 := "E1_NATUREZ"
		titulo := titulo + OemToAnsi(STR0021)  //" - Por Natureza"
	Elseif nOrdem = 6
		SE1->(dbSetOrder(6))
		#IFNDEF TOP
			dbSeek( cFilial+DTOS(mv_par13))
		#ELSE
			cOrder := SqlOrder(IndexKey())
		#ENDIF
		cCond1 := "E1_EMISSAO <= mv_par14"
		cCond2 := "E1_EMISSAO"
		titulo := titulo + OemToAnsi(STR0042)  //" - Por Emissao"
	Elseif nOrdem == 7
		cChaveSe1 := "E1_FILIAL+DTOS(E1_VENCREA)+E1_PORTADO+E1_PREFIXO+E1_NUM+E1_PARCELA+E1_TIPO"
		#IFNDEF TOP
			cIndexSe1 := CriaTrab(nil,.f.)
			IndRegua("SE1",cIndexSe1,cChaveSe1,,u_Fr130IndR(),OemToAnsi(STR0022))
			nIndexSE1 := RetIndex("SE1")
			dbSetIndex(cIndexSe1+OrdBagExt())
			dbSetOrder(nIndexSe1+1)
			dbSeek(xFilial("SE1"))
		#ELSE
			cOrder := SqlOrder(cChaveSe1)
		#ENDIF
		cCond1 := "E1_VENCREA <= mv_par10"
		cCond2 := "DtoS(E1_VENCREA)+E1_PORTADO"
		titulo := titulo + OemToAnsi(STR0023)  //" - Por Vencto/Banco"
	Elseif nOrdem = 8
		SE1->(dbSetOrder(2))
		#IFNDEF TOP
			dbSeek(cFilial+mv_par01,.T.)
		#ELSE
			cOrder := SqlOrder(IndexKey())
		#ENDIF
		cCond1 := "E1_CLIENTE <= mv_par02"
		cCond2 := "E1_CLIENTE"
		titulo := titulo + OemToAnsi(STR0024)  //" - Por Cod.Cliente"
	Elseif nOrdem = 9
		cChave := "E1_FILIAL+E1_PORTADO+E1_SITUACA+E1_NOMCLI+E1_PREFIXO+E1_NUM+E1_PARCELA+E1_TIPO"
		#IFNDEF TOP
			dbSelectArea("SE1")
			cIndex := CriaTrab(nil,.f.)
			IndRegua("SE1",cIndex,cChave,,u_fr130IndR(),OemToAnsi(STR0022))
			nIndex := RetIndex("SE1")
			dbSetIndex(cIndex+OrdBagExt())
			dbSetOrder(nIndex+1)
			dbSeek(xFilial("SE1"))
		#ELSE
			cOrder := SqlOrder(cChave)
		#ENDIF
		cCond1 := "E1_PORTADO <= mv_par08"
		cCond2 := "E1_PORTADO+E1_SITUACA"
		titulo := titulo + OemToAnsi(STR0025)  //" - Por Banco e Situacao"
	ElseIf nOrdem == 10
		cChave := "E1_FILIAL+E1_NUM+E1_TIPO+E1_PREFIXO+E1_PARCELA"
		#IFNDEF TOP
			dbSelectArea("SE1")
			cIndex := CriaTrab(nil,.f.)
			IndRegua("SE1",cIndex,cChave,,,OemToAnsi(STR0022))
			nIndex := RetIndex("SE1")
			dbSetIndex(cIndex+OrdBagExt())
			dbSetOrder(nIndex+1)
			dbSeek(xFilial("SE1")+mv_par05)
		#ELSE
			cOrder := SqlOrder(cChave)
		#ENDIF
		cCond1 := "E1_NUM <= mv_par06"
		cCond2 := "E1_NUM"
		titulo := titulo + OemToAnsi(STR0048)  //" - Numero/Prefixo"	
	ElseIf nOrdem == 11
		cChaveSe1 := "E1_FILIAL+E1_NOMCLI+E1_CLIENTE+E1_LOJA+E1_PREFIXO+E1_NUM+E1_PARCELA+E1_TIPO"
		cCond1 := "E1_CLIENTE <= mv_par02"
		cCond2 := "E1_CLIENTE + E1_LOJA"
		titulo := titulo + OemToAnsi(" - Por Grupo")  //" - Por Cliente"
//		If mv_par19 == 1
			cOrder := "E1_FILIAL,E1_CLIENTE,E1_LOJA,E1_PREFIXO,E1_NUM,E1_PARCELA,E1_TIPO"
//		Else
//			cOrder := "E1_CLIENTE,E1_LOJA,E1_FILIAL,E1_PREFIXO,E1_NUM,E1_PARCELA,E1_TIPO"
//		EndIf
	Endif
	
	If mv_par19 == 1
		titulo := titulo + OemToAnsi(STR0026)  //" - Analitico"
	Else
		titulo := titulo + OemToAnsi(STR0027)  //" - Sintetico"
		cabec1 := OemToAnsi(STR0044)  //"Nome do Cliente      |        Titulos Vencidos          | Titulos a Vencer |            Vlr.juros ou             (Vencidos+Vencer)"
		cabec2 := OemToAnsi(STR0045)  //"|  Valor Nominal   Valor Corrigido |   Valor Nominal  |             permanencia                              "
	EndIf
	
	cFilterUser:=aReturn[7]
	Set Softseek Off
	
	#IFDEF TOP
		cQuery += " AND E1_CLIENTE between '" + mv_par01        + "' AND '" + mv_par02 + "'"
		cQuery += " AND E1_PREFIXO between '" + mv_par03        + "' AND '" + mv_par04 + "'"
		cQuery += " AND E1_NUM     between '" + mv_par05        + "' AND '" + mv_par06 + "'"
		cQuery += " AND E1_PORTADO between '" + mv_par07        + "' AND '" + mv_par08 + "'"
		cQuery += " AND E1_VENCREA between '" + DTOS(mv_par09)  + "' AND '" + DTOS(mv_par10) + "'"
		cQuery += " AND (E1_MULTNAT = '1' OR (E1_NATUREZ BETWEEN '"+MV_PAR11+"' AND '"+MV_PAR12+"'))"
		cQuery += " AND E1_EMISSAO between '" + DTOS(mv_par13)  + "' AND '" + DTOS(mv_par14) + "'"
		cQuery += " AND E1_LOJA    between '" + mv_par24        + "' AND '" + mv_par25 + "'"

		If MV_PAR38 == 2 //Nao considerar titulos com emissao futura
			cQuery += " AND E1_EMISSAO <=      '" + DTOS(dDataBase) + "'"
		Endif

		cQuery += " AND ((E1_EMIS1  Between '"+ DTOS(mv_par27)+"' AND '"+DTOS(mv_par28)+"') OR E1_EMISSAO Between '"+DTOS(mv_par27)+"' AND '"+DTOS(mv_par28)+"')"
		If !Empty(mv_par31) // Deseja imprimir apenas os tipos do parametro 31
			cQuery += " AND E1_TIPO IN "+FormatIn(mv_par31,";") 
		ElseIf !Empty(Mv_par32) // Deseja excluir os tipos do parametro 32
			cQuery += " AND E1_TIPO NOT IN "+FormatIn(mv_par32,";")
		EndIf
		If mv_par18 == 2
			cQuery += " AND E1_SITUACA NOT IN ('2','7')"
		Endif
		If mv_par20 == 2
			cQuery += ' AND E1_SALDO <> 0'
		Endif
		If mv_par34 == 1
			cQuery += " AND E1_FLUXO <> 'N'"
		Endif               

        //ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
        //³ Ponto de entrada para inclusao de parametros no filtro a ser executado ³
        //ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
	    If lF130Qry 
			cQuery += ExecBlock("GFI130QRY",.f.,.f.)
		Endif
		cQuery += "   AND D_E_L_E_T_ <> '*' "
		cQuery += " ORDER BY "+ cOrder
		
//		cQuery := ChangeQuery(cQuery)
		
		dbSelectArea("SE1")
		dbCloseArea()
		dbSelectArea("SA1")

//		MEMOWRIT("D:\TEMP\FINR130.SQL",cQuery)
		
		dbUseArea(.T., "TOPCONN", TCGenQry(,,cQuery), 'SE1', .F., .T.)
		
		For ni := 1 to Len(aStru)
			If aStru[ni,2] != 'C'
				TCSetField('SE1', aStru[ni,1], aStru[ni,2],aStru[ni,3],aStru[ni,4])
			Endif
		Next
	#ENDIF
	SetRegua(nTotsRec)
	
	If MV_MULNATR .And. nOrdem == 5
		Finr135(cTipos, lEnd, @nTot0, @nTot1, @nTot2, @nTot3, @nTotTit, @nTotJ )
		#IFDEF TOP
			dbSelectArea("SE1")
			dbCloseArea()
			ChKFile("SE1")
			dbSelectArea("SE1")
			dbSetOrder(1)
		#ENDIF
		If Empty(xFilial("SE1"))
			//Exit
			RETURN
		Endif
//		dbSelectArea("SM0")
//		dbSkip()
//		Loop
	Endif
	
	cBkFilial:=SE1->E1_FILIAL
	cBkVto:=SE1->E1_VENCREA
	If nOrdem == 11
		aGrupo:={}
		aGrupo:=array(20,0)
		cGrupo:=""
		nIndGrp:=1
	EndIf
	While &cCond1 .and. !Eof() .and. lContinua
		
		IF	lEnd
			@PROW()+1,001 PSAY OemToAnsi(STR0028)  //"CANCELADO PELO OPERADOR"
			Exit
		Endif
		
		IncRegua()
		
		Store 0 To nTit1,nTit2,nTit3,nTit4,nTit5
		
		//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
		//³ Carrega data do registro para permitir ³
		//³ posterior analise de quebra por mes.   ³
		//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
		dDataAnt := Iif(nOrdem == 6 , SE1->E1_EMISSAO,  SE1->E1_VENCREA)
		
		cCarAnt := &cCond2
		While &cCond2==cCarAnt .and. !Eof() .and. lContinua //.and. E1_FILIAL == xFilial("SE1")
			aSResA:={}
			IF lEnd
				@PROW()+1,001 PSAY OemToAnsi(STR0028)  //"CANCELADO PELO OPERADOR"
				lContinua := .F.
				Exit
			EndIF
			
			IncRegua()
			
			dbSelectArea("SE1")
			//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
			//³ Filtrar com base no Pto de entrada do Usuario...             ³
			//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄJose Lucas, Localiza‡”es ArgentinaÄÙ
			If !Empty(cTipos)
				If !(SE1->E1_TIPO $ cTipos)
					dbSkip()
					Loop
				Endif
			Endif
			
			//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
			//³ Considera filtro do usuario                                  ³
			//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
			If !Empty(cFilterUser).and.!(&cFilterUser)
				dbSkip()
				Loop
			Endif
			
			//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
			//³ Verifica se titulo, apesar do E1_SALDO = 0, deve aparecer ou ³
			//³ nÆo no relat¢rio quando se considera database (mv_par20 = 1) ³
			//³ ou caso nÆo se considere a database, se o titulo foi totalmen³
			//³ te baixado.																  ³
			//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
			dbSelectArea("SE1")
			IF !Empty(SE1->E1_BAIXA) .and. Iif(mv_par20 == 2 ,SE1->E1_SALDO == 0 ,;
					IIF(mv_par37 == 1,(SE1->E1_SALDO == 0 .and. SE1->E1_BAIXA <= dDataBase),.F.))
				dbSkip()
				Loop
			EndIF
			
			//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
			//³ Verifica se trata-se de abatimento ou somente titulos³
			//³ at‚ a data base. 									 ³
			//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
			IF (SE1->E1_TIPO $ MVABATIM .And. mv_par33 != 1) .Or.;
				(SE1->E1_EMISSAO > dDataBase .and. MV_PAR38 == 2)
				dbSkip()
				Loop
			Endif
			
			//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
			//³ Verifica se ser  impresso titulos provis¢rios		 ³
			//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
			IF E1_TIPO $ MVPROVIS .and. mv_par16 == 2
				dbSkip()
				Loop
			Endif
			
			//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
			//³ Verifica se ser  impresso titulos de Adiantamento	 ³
			//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
			IF SE1->E1_TIPO $ MVRECANT+"/"+MV_CRNEG .and. mv_par26 == 2
				dbSkip()
				Loop
			Endif
			
			// dDtContab para casos em que o campo E1_EMIS1 esteja vazio
			dDtContab := Iif(Empty(SE1->E1_EMIS1),SE1->E1_EMISSAO,SE1->E1_EMIS1)
			
			//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
			//³ Verifica se esta dentro dos parametros ³
			//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
			dbSelectArea("SE1")
			IF SE1->E1_CLIENTE < mv_par01 .OR. SE1->E1_CLIENTE > mv_par02 .OR. ;
				SE1->E1_PREFIXO < mv_par03 .OR. SE1->E1_PREFIXO > mv_par04 .OR. ;
				SE1->E1_NUM	 	 < mv_par05 .OR. SE1->E1_NUM 		> mv_par06 .OR. ;
				SE1->E1_PORTADO < mv_par07 .OR. SE1->E1_PORTADO > mv_par08 .OR. ;
				SE1->E1_VENCREA < mv_par09 .OR. SE1->E1_VENCREA > mv_par10 .OR. ;
				SE1->E1_NATUREZ < mv_par11 .OR. SE1->E1_NATUREZ > mv_par12 .OR. ;
				SE1->E1_EMISSAO < mv_par13 .OR. SE1->E1_EMISSAO > mv_par14 .OR. ;
				SE1->E1_LOJA    < mv_par24 .OR. SE1->E1_LOJA    > mv_par25 .OR. ;
				dDtContab       < mv_par27 .OR. dDtContab       > mv_par28 .OR. ;
				(SE1->E1_EMISSAO > dDataBase .and. MV_PAR38 == 2) .Or. !&(u_fr130IndR())
				dbSkip()
				Loop
			Endif
			
			If mv_par18 == 2 .and. E1_SITUACA $ "27"
				dbSkip()
				Loop
			Endif
			
			//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
			//³ Verifica se deve imprimir outras moedas³
			//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
			If mv_par30 == 2 // nao imprime
				if SE1->E1_MOEDA != mv_par15 //verifica moeda do campo=moeda parametro
					dbSkip()
					Loop
				endif
			Endif
			
			
			dDataReaj := IIF(SE1->E1_VENCREA < dDataBase ,;
				IIF(mv_par17=1,dDataBase,E1_VENCREA),;
				dDataBase)
			
			If mv_par20 == 1	// Considera Data Base
				nSaldo :=SaldoTit(SE1->E1_PREFIXO,SE1->E1_NUM,SE1->E1_PARCELA,SE1->E1_TIPO,SE1->E1_NATUREZ,"R",SE1->E1_CLIENTE,mv_par15,dDataReaj,,SE1->E1_LOJA,,If(cPaisLoc=="BRA",SE1->E1_TXMOEDA,0),mv_par37)
				// Subtrai decrescimo para recompor o saldo na data escolhida.
				If Str(SE1->E1_VALOR,17,2) == Str(nSaldo,17,2) .And. SE1->E1_DECRESC > 0 .And. SE1->E1_SDDECRE == 0
					nSAldo -= SE1->E1_DECRESC
				Endif
				// Soma Acrescimo para recompor o saldo na data escolhida.
				If Str(SE1->E1_VALOR,17,2) == Str(nSaldo,17,2) .And. SE1->E1_ACRESC > 0 .And. SE1->E1_SDACRES == 0
					nSAldo += SE1->E1_ACRESC
				Endif

				//Se abatimento verifico a data da baixa.
				//Por nao possuirem movimento de baixa no SE5, a saldotit retorna 
				//sempre saldo em aberto quando mv_par33 = 1 (Abatimentos = Lista)
				If SE1->E1_TIPO $ MVABATIM .and. ;
					((SE1->E1_BAIXA <= dDataBase .and. !Empty(SE1->E1_BAIXA)) .or. ;
					 (SE1->E1_MOVIMEN <= dDataBase .and. !Empty(SE1->E1_MOVIMEN))	)			
					nSaldo := 0
				Endif

			Else
				nSaldo := xMoeda((SE1->E1_SALDO+SE1->E1_SDACRES-SE1->E1_SDDECRE),SE1->E1_MOEDA,mv_par15,dDataReaj,ndecs+1,If(cPaisLoc=="BRA",SE1->E1_TXMOEDA,0))
			Endif

			//Caso exista desconto financeiro (cadastrado na inclusao do titulo), 
			//subtrai do valor principal.
			nDescont := FaDescFin("SE1",dBaixa,nSaldo,1)   
			If nDescont > 0
				nSaldo := nSaldo - nDescont
			Endif
			
			If ! SE1->E1_TIPO $ MVABATIM
				If ! (SE1->E1_TIPO $ MVRECANT+"/"+MV_CRNEG) .And. ;
						!( MV_PAR20 == 2 .And. nSaldo == 0 )  	// deve olhar abatimento pois e zerado o saldo na liquidacao final do titulo

					//Quando considerar Titulos com emissao futura, eh necessario
					//colocar-se a database para o futuro de forma que a Somaabat()
					//considere os titulos de abatimento
					If mv_par38 == 1
						dOldData := dDataBase
						dDataBase := CTOD("31/12/40")
					Endif

					nAbatim := SomaAbat(SE1->E1_PREFIXO,SE1->E1_NUM,SE1->E1_PARCELA,"R",mv_par15,dDataReaj,SE1->E1_CLIENTE,SE1->E1_LOJA)

					If mv_par38 == 1
						dDataBase := dOldData
					Endif

					If STR(nSaldo,17,2) == STR(nAbatim,17,2)
						nSaldo := 0
					ElseIf mv_par33 != 3
						nSaldo-= nAbatim
					Endif
				EndIf
			Endif	
			nSaldo:=Round(NoRound(nSaldo,3),2)
			
			//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
			//³ Desconsidera caso saldo seja menor ou igual a zero   ³
			//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
			If nSaldo <= 0
				dbSkip()
				Loop
			Endif
			
			dbSelectArea("SA1")
			cFilial:=SE1->E1_FILIAL
			MSSeek(cFilial+SE1->E1_CLIENTE+SE1->E1_LOJA)
			dbSelectArea("SA6")
			MSSeek(cFilial+SE1->E1_PORTADO)
			dbSelectArea("SE1")

			If mv_par19 == 1
				If nOrdem == 4 .or. nOrdem == 11
					// Por Venc/Cli - Por Grupo
					aAdd(aSResA,{"AN",li,0,SE1->E1_CLIENTE + "-" + SE1->E1_LOJA + "-" +SubStr( SE1->E1_NOMCLI, 1, 17 ),;
					      SE1->E1_CLIENTE + SE1->E1_LOJA+SE1->E1_FILIAL,Posicione("SA1",1,xFilial("SA1")+SE1->E1_CLIENTE+SE1->E1_LOJA,"A1_GRUPO")})
				Else
					@li,	0 PSAY SE1->E1_CLIENTE + "-" + SE1->E1_LOJA + "-" +;
						SubStr( SE1->E1_NOMCLI, 1, 17 )
				EndIf
				li := IIf (aTamCli[1] > 6,li+1,li)
				If nOrdem == 4 .or. nOrdem == 11
					aAdd(aSResA,{"AN",li,28,SE1->E1_PREFIXO+"-"+SE1->E1_NUM+"-"+SE1->E1_PARCELA})
				Else
					@li, 28 PSAY SE1->E1_PREFIXO+"-"+SE1->E1_NUM+"-"+SE1->E1_PARCELA
				EndIf
				If SE1->E1_TIPO$MVABATIM
					If nOrdem == 4 .or. nOrdem == 11
						aAdd(aSResA,{"AN",li,46,"["})
	    			Else
						@li,46 PSAY "["
					EndIf
				Endif                          
				// Por Venc/Cli - Por Grupo				
				If nOrdem == 4 .or. nOrdem == 11
					aAdd(aSResA,{"AN",li,47,SE1->E1_TIPO})
				Else
					@li, 47 PSAY SE1->E1_TIPO
				EndIf
				If SE1->E1_TIPO$MVABATIM
					// Por Venc/Cli - Por Grupo				
					If nOrdem == 4 .or. nOrdem == 11
						aAdd(aSResA,{"AN",li,50,"]"})
					Else
						@li,50 PSAY "]"
					EndIf
				Endif
				// Por Venc/Cli - Por Grupo
				If nOrdem == 4 .or. nOrdem == 11
					aAdd(aSResA,{"AN",li,51,SE1->E1_NATUREZ})
					aAdd(aSResA,{"AN",li,62,SE1->E1_EMISSAO})
					aAdd(aSResA,{"AN",li,73,SE1->E1_VENCTO})
					aAdd(aSResA,{"AN",li,84,SE1->E1_VENCREA})
					aAdd(aSResA,{"AN",li,95,SE1->E1_PORTADO+" "+SE1->E1_SITUACA})
					aAdd(aSResA,{"AN",li,101,Round(NoRound(xMoeda(SE1->E1_VALOR,SE1->E1_MOEDA,mv_par15,SE1->E1_EMISSAO,ndecs+1,If(cPaisLoc=="BRA",SE1->E1_TXMOEDA,0))* If(SE1->E1_TIPO$MVABATIM+"/"+MV_CRNEG+"/"+MVRECANT, -1,1),nDecs+1),nDecs)})
//					aAdd(aSResA,{"AN",li,101,Transform(Round(NoRound(xMoeda(SE1->E1_VALOR,SE1->E1_MOEDA,mv_par15,SE1->E1_EMISSAO,ndecs+1,If(cPaisLoc=="BRA",SE1->E1_TXMOEDA,0))* If(SE1->E1_TIPO$MVABATIM+"/"+MV_CRNEG+"/"+MVRECANT, -1,1),nDecs+1),nDecs),PesqPict("SE1","E1_VALOR",14,MV_PAR15))})
				Else
					@li, 51 PSAY SE1->E1_NATUREZ
					@li, 62 PSAY SE1->E1_EMISSAO
					@li, 73 PSAY SE1->E1_VENCTO
					@li, 84 PSAY SE1->E1_VENCREA
					@li, 95 PSAY SE1->E1_PORTADO+" "+SE1->E1_SITUACA
					@li,101 PSAY Round(NoRound(xMoeda(SE1->E1_VALOR,SE1->E1_MOEDA,mv_par15,SE1->E1_EMISSAO,ndecs+1,If(cPaisLoc=="BRA",SE1->E1_TXMOEDA,0))* If(SE1->E1_TIPO$MVABATIM+"/"+MV_CRNEG+"/"+MVRECANT, -1,1),nDecs+1),nDecs) Picture PesqPict("SE1","E1_VALOR",14,MV_PAR15)
				EndIf
			Endif
			
			If dDataBase > E1_VENCREA	//vencidos
				If mv_par19 == 1
					If ! SE1->E1_TIPO $ MVABATIM        
						// Por Venc/Cli - Por Grupo					
						If nOrdem == 4 .or. nOrdem == 11
							aAdd(aSResA,{"AN",li,116,nSaldo * If(SE1->E1_TIPO$MV_CRNEG+"/"+MVRECANT, -1,1)})
	//						aAdd(aSResA,{"AN",li,116,Transform(nSaldo * If(SE1->E1_TIPO$MV_CRNEG+"/"+MVRECANT, -1,1),TM(nSaldo,14,nDecs))})
						Else
							@li, 116 PSAY nSaldo * If(SE1->E1_TIPO$MV_CRNEG+"/"+MVRECANT, -1,1)  Picture TM(nSaldo,14,nDecs)
						EndIf
					EndIf
				EndIf
				nJuros:=0
				fa070Juros(mv_par15)
				dbSelectArea("SE1")
				If mv_par19 == 1
					// Por Venc/Cli - Por Grupo				
					If nOrdem == 4 .or. nOrdem == 11
						aAdd(aSResA,{"AN",li,133,(nSaldo+nJuros)* If(SE1->E1_TIPO$MV_CRNEG+"/"+MVRECANT, -1,1)})
//						aAdd(aSResA,{"AN",li,133,Transform((nSaldo+nJuros)* If(SE1->E1_TIPO$MV_CRNEG+"/"+MVRECANT, -1,1),TM(nSaldo+nJuros,14,nDecs))})
					Else
						@li,133 PSAY (nSaldo+nJuros)* If(SE1->E1_TIPO$MV_CRNEG+"/"+MVRECANT, -1,1) Picture TM(nSaldo+nJuros,14,nDecs)
					EndIf
				EndIf
				If SE1->E1_TIPO $ MVRECANT+"/"+MV_CRNEG
					nTit0 -= Round(NoRound(xMoeda(SE1->E1_VALOR,SE1->E1_MOEDA,mv_par15,SE1->E1_EMISSAO,ndecs+1,If(cPaisLoc=="BRA",SE1->E1_TXMOEDA,0)),ndecs+1),ndecs)
					nTit1 -= (nSaldo)
					nTit2 -= (nSaldo+nJuros)
					nMesTit0 -= Round(NoRound( xMoeda(SE1->E1_VALOR,SE1->E1_MOEDA,mv_par15,SE1->E1_EMISSAO,ndecs+1,If(cPaisLoc=="BRA",SE1->E1_TXMOEDA,0)),ndecs+1),ndecs)
					nMesTit1 -= (nSaldo)
					nMesTit2 -= (nSaldo+nJuros)
					nTotJur  -= nJuros
					nMesTitj -= nJuros
					nTotFilJ -= nJuros
				Else
					If !SE1->E1_TIPO $ MVABATIM
						nTit0 += Round(NoRound(xMoeda(SE1->E1_VALOR,SE1->E1_MOEDA,mv_par15,SE1->E1_EMISSAO,ndecs+1,If(cPaisLoc=="BRA",SE1->E1_TXMOEDA,0)),ndecs+1),ndecs)						
						nTit1 += (nSaldo)
						nTit2 += (nSaldo+nJuros)
						nMesTit0 += Round(NoRound(xMoeda(SE1->E1_VALOR,SE1->E1_MOEDA,mv_par15,SE1->E1_EMISSAO,ndecs+1,If(cPaisLoc=="BRA",SE1->E1_TXMOEDA,0)),ndecs+1),ndecs)
						nMesTit1 += (nSaldo)
						nMesTit2 += (nSaldo+nJuros)
						nTotJur  += nJuros
						nMesTitj += nJuros
						nTotFilJ += nJuros
					Endif	
				Endif
			Else						//a vencer
				If mv_par19 == 1               
					// Por Venc/Cli - Por Grupo
					If nOrdem == 4 .or. nOrdem == 11
						aAdd(aSResA,{"AN",li,149,nSaldo * If(SE1->E1_TIPO$MV_CRNEG+"/"+MVRECANT, -1,1)})
//						aAdd(aSResA,{"AN",li,149,Transform(nSaldo * If(SE1->E1_TIPO$MV_CRNEG+"/"+MVRECANT, -1,1),TM(nSaldo,14,nDecs))})
					Else
						@li,149 PSAY nSaldo * If(SE1->E1_TIPO$MV_CRNEG+"/"+MVRECANT, -1,1)  Picture TM(nSaldo,14,nDecs)
					EndIf
				EndIf
				If ! ( SE1->E1_TIPO $ MVRECANT+"/"+MV_CRNEG)
					If !SE1->E1_TIPO $ MVABATIM
						nTit0 += Round(NoRound(xMoeda(SE1->E1_VALOR,SE1->E1_MOEDA,mv_par15,SE1->E1_EMISSAO,ndecs+1,If(cPaisLoc=="BRA",SE1->E1_TXMOEDA,0)),ndecs+1),ndecs)
						nTit3 += (nSaldo-nTotAbat)
						nTit4 += (nSaldo-nTotAbat)
						nMesTit0 += Round(NoRound(xMoeda(SE1->E1_VALOR,SE1->E1_MOEDA,mv_par15,SE1->E1_EMISSAO,ndecs+1,If(cPaisLoc=="BRA",SE1->E1_TXMOEDA,0)),ndecs+1),ndecs)
						nMesTit3 += (nSaldo-nTotAbat)
						nMesTit4 += (nSaldo-nTotAbat)
					EndIf
				Else
					nTit0 -= Round(NoRound(xMoeda(SE1->E1_VALOR,SE1->E1_MOEDA,mv_par15,SE1->E1_EMISSAO,ndecs+1,If(cPaisLoc=="BRA",SE1->E1_TXMOEDA,0)),ndecs+1),ndecs)
					nTit3 -= (nSaldo-nTotAbat)
					nTit4 -= (nSaldo-nTotAbat)
					nMesTit0 -= Round(NoRound(xMoeda(SE1->E1_VALOR,SE1->E1_MOEDA,mv_par15,SE1->E1_EMISSAO,ndecs+1,If(cPaisLoc=="BRA",SE1->E1_TXMOEDA,0)),ndecs+1),ndecs)
					nMesTit3 -= (nSaldo-nTotAbat)
					nMesTit4 -= (nSaldo-nTotAbat)
				Endif
			Endif
			
			If mv_par19 == 1                   
				// Por Venc/Cli - Por Grupo
				If nOrdem == 4 .or. nOrdem == 11
					aAdd(aSResA,{"AN",li,164,SE1->E1_NUMBCO})
				Else
					@ li, 164 PSAY SE1->E1_NUMBCO
				EndIf
			EndIf
			If nJuros > 0
				If mv_par19 == 1
					// Por Venc/Cli - Por Grupo
					If nOrdem == 4 .or. nOrdem == 11
						aAdd(aSResA,{"AN",li,181,nJuros})
//						aAdd(aSResA,{"AN",li,181,Transform(nJuros,PesqPict("SE1","E1_JUROS",10,MV_PAR15))})
					Else
						@ Li,181 PSAY nJuros Picture PesqPict("SE1","E1_JUROS",10,MV_PAR15)
					EndIf
				EndIf
				nJuros := 0
			Endif
			
			IF dDataBase > SE1->E1_VENCREA
				nAtraso:=dDataBase-SE1->E1_VENCTO
				IF Dow(SE1->E1_VENCTO) == 1 .Or. Dow(SE1->E1_VENCTO) == 7
					IF Dow(dBaixa) == 2 .and. nAtraso <= 2
						nAtraso := 0
					EndIF
				EndIF
				nAtraso:=IIF(nAtraso<0,0,nAtraso)
				IF nAtraso>0
					If mv_par19 == 1
						If nOrdem == 4 .or. nOrdem == 11
							aAdd(aSResA,{"AN",li,195,Transform(nAtraso,"9999")})
						Else
							@li ,195 PSAY nAtraso Picture "9999"
						EndIf
					EndIf
				EndIF
			EndIF
			If mv_par19 == 1                  
				// Por Venc/Cli - Por Grupo			
				If nOrdem == 4 .or. nOrdem == 11
					aAdd(aSResA,{"AN",li,200,SubStr(SE1->E1_HIST,1,20)+ ;
						IIF(E1_TIPO $ MVPROVIS,"*"," ")+ ;				
						Iif(nSaldo == Round(NoRound(xMoeda(SE1->E1_VALOR,SE1->E1_MOEDA,mv_par15,SE1->E1_EMISSAO,ndecs+1,If(cPaisLoc=="BRA",SE1->E1_TXMOEDA,0)),ndecs+1),ndecs)," ","P")})
				Else
					@li,200 PSAY SubStr(SE1->E1_HIST,1,20)+ ;
						IIF(E1_TIPO $ MVPROVIS,"*"," ")+ ;
						Iif(nSaldo == Round(NoRound(xMoeda(SE1->E1_VALOR,SE1->E1_MOEDA,mv_par15,SE1->E1_EMISSAO,ndecs+1,If(cPaisLoc=="BRA",SE1->E1_TXMOEDA,0)),ndecs+1),ndecs)," ","P")
				EndIf
			EndIf
			
			//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
			//³ Carrega data do registro para permitir ³
			//³ posterior an lise de quebra por mes.   ³
			//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
 			dDataAnt := Iif(nOrdem == 6, SE1->E1_EMISSAO, SE1->E1_VENCREA)

			cBkFilial:=SE1->E1_FILIAL
			cBkVto:=SE1->E1_VENCREA
			cBkCliente:=SE1->E1_CLIENTE+SE1->E1_LOJA+SE1->E1_FILIAL
			If mv_par19 == 1
				If nOrdem == 4
					lInclui:=.t.
					If len(aSRes) > 0
						nX:=len(aSRes)
						While nX > 0
							If aSRes[nX,1] == "AN"
								exit
							EndIf
							nX--
						EndDo
						If aSRes[nX,2,7,4] != cBkVto .and. !lTMes
								aAdd(aSRes,{"TD",aSRes[len(aSRes),2],0,0,0,0,0,nOrdem,aSRes[len(aSRes),2],0,nDecs})
						ElseIf !lTMes
							lTMes:=.f.
						EndIf
					EndIf
					If lInclui
						aAdd(aSRes,{"AN",aSResA})
					EndIf
					If lTMes
						lTMes:=.f.
					EndIf
				ElseIf nOrdem == 11
					nIndGrp:=val(aSResA[1,6])
					If nIndGrp > 4
						nIndGrp-=3
					Else
						nIndGrp:=1
					EndIf
					If !(alltrim(str(nIndGrp)) $ cGrupo)
						cGrupo+="|"+alltrim(str(nIndGrp))
					EndIf
					aAdd(aGrupo[nIndGrp],aSResA)
				EndIf
			EndIf
			dbSkip()
			nTotTit ++
			nMesTTit ++
			nTotFiltit++
			nTit5 ++
			If mv_par19 == 1
				li++
			EndIf
			IF nTit5 > 0 .and. nOrdem != 2 .and. nOrdem != 10 //.and. !lLoop // .or. lLoop // .and. cBkFilial != SE1->E1_FILIAL
				If mv_par19 == 1
					If nOrdem == 4
						lInclui:=.t.
						If lInclui
							aAdd(aSRes,{cBkFilial,cBkVto,nTit0,nTit1,nTit2,nTit3,nTit4,nOrdem,cCarAnt,nTotJur,nDecs,cBkCliente})
						EndIf
					ElseIf nOrdem == 11
						//aAdd(aGrupo[nIndGrp],{cBkFilial,cBkVto,nTit0,nTit1,nTit2,nTit3,nTit4,nOrdem,cCarAnt,nTotJur,nDecs,cBkCliente})
					EndIf
				Else
					If nOrdem == 4
						lInclui:=.t.
						for nX:=1 to len(aSRes)
							if aSRes[nX,1] == cBkFilial .and. aSRes[nX,2] == cBkVto
								aSRes[nX,3]+=nTit0
								aSRes[nX,4]+=nTit1
								aSRes[nX,5]+=nTit2
								aSRes[nX,6]+=nTit3
								aSRes[nX,7]+=nTit4
								aSRes[nX,8]:=nOrdem
								aSRes[nX,9]:=cCarAnt
								aSRes[nX,10]+=nTotJur
								aSRes[nX,11]:=nDecs
								lInclui:=.f.
							EndIf
						Next
						If lInclui
							If len(aSRes) > 0 .and. aSRes[len(aSRes),2]!= cBkVto .and. aSRes[len(aSRes),1] != "TM"
								aAdd(aSRes,{"TD",aSRes[len(aSRes),2],0,0,0,0,0,nOrdem,aSRes[len(aSRes),2],0,nDecs})
							EndIf
							aAdd(aSRes,{cBkFilial,cBkVto,nTit0,nTit1,nTit2,nTit3,nTit4,nOrdem,cCarAnt,nTotJur,nDecs})
						EndIf
					ElseIf nOrdem == 11
						nIndGrp:=val(Posicione("SA1",1,xFilial("SA1")+substr(cBkCliente,1,len(cBkCliente)-2),"A1_GRUPO"))
						nGrupo:=nIndGrp
						If nIndGrp > 4
							nIndGrp-=3
						Else
							nIndGrp:=1
						EndIf
						If !(alltrim(str(nIndGrp)) $ cGrupo)
							cGrupo+="|"+alltrim(str(nIndGrp))
						EndIf
						aAdd(aGrupo[nIndGrp],{cBkFilial,cBkVto,nTit0,nTit1,nTit2,nTit3,nTit4,nOrdem,cCarAnt,nTotJur,nDecs,nGrupo,substr(cBkCliente,1,len(cBkCliente)-2)})
					EndIf
				EndIf
				If mv_par19 == 1
					Li++
				EndIf
				nTot0+=nTit0
				nTot1+=nTit1
				nTot2+=nTit2
				nTot3+=nTit3
				nTot4+=nTit4
				nTotJ+=nTotJur
				
				nTotFil0+=nTit0
				nTotFil1+=nTit1
				nTotFil2+=nTit2
				nTotFil3+=nTit3
				nTotFil4+=nTit4
				Store 0 To nTit0,nTit1,nTit2,nTit3,nTit4,nTit5,nTotJur,nTotAbat

			Endif

		Enddo

	
		//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
		//³ Verifica quebra por mˆs	  			   ³
		//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
		lQuebra := .F.
		If (nOrdem == 4 .or. nOrdem == 1)  .and. (Month(SE1->E1_VENCREA) # Month(dDataAnt) .or. SE1->E1_VENCREA > mv_par10)
			lQuebra := .T.
		Elseif nOrdem == 6 .and. (Month(SE1->E1_EMISSAO) # Month(dDataAnt) .or. SE1->E1_EMISSAO > mv_par14)
			lQuebra := .T.
		Endif
		If lQuebra .and. nMesTTit # 0
			If mv_par19 == 1
				If nOrdem == 4
//					ImpMes130(nMesTit0,nMesTit1,nMesTit2,nMesTit3,nMesTit4,nMesTTit,nMesTitJ,nDecs)
//				ElseIf nOrdem !=1
					aAdd(aSRes,{"TD",aSRes[len(aSRes),2],0,0,0,0,0,nOrdem,aSRes[len(aSRes),2],0,nDecs})
					aAdd(aSRes,{"TM",cBkVto,nMesTit0,nMesTit1,nMesTit2,nMesTit3,nMesTit4,nMesTTit,nMesTitJ,nDecs,0})
				EndIf
				lTMes:=.t.
			Else
				If nOrdem == 4
					lInclui:=.t.
					for nX:=1 to len(aSRes)
						if aSRes[nX,1] == "TM" .and. str(month(aSRes[nX,2]))+str(year(aSRes[nX,2])) == str(month(cBkVto))+str(year(cBkVto))
							aSRes[nX,3]+=nMesTit0
							aSRes[nX,3]+=nMesTit1
							aSRes[nX,3]+=nMesTit2
							aSRes[nX,3]+=nMesTit3
							aSRes[nX,3]+=nMesTit4
							aSRes[nX,3]+=nMesTTit
							aSRes[nX,3]+=nMesTitJ
							aSRes[nX,3]:=nDecs
							lInclui:=.f.
						EndIf
					Next
					If lInclui
						aAdd(aSRes,{"TD",aSRes[len(aSRes),2],0,0,0,0,0,nOrdem,aSRes[len(aSRes),2],0,nDecs})
						aAdd(aSRes,{"TM",cBkVto,nMesTit0,nMesTit1,nMesTit2,nMesTit3,nMesTit4,nMesTTit,nMesTitJ,nDecs,0})
					EndIf
				EndIf
			EndIf
			nMesTit0 := nMesTit1 := nMesTit2 := nMesTit3 := nMesTit4 := nMesTTit := nMesTitj := 0
		Endif
		nTot0+=nTit0
		nTot1+=nTit1
		nTot2+=nTit2
		nTot3+=nTit3
		nTot4+=nTit4
		nTotJ+=nTotJur
		
		nTotFil0+=nTit0
		nTotFil1+=nTit1
		nTotFil2+=nTit2
		nTotFil3+=nTit3
		nTotFil4+=nTit4
		Store 0 To nTit0,nTit1,nTit2,nTit3,nTit4,nTit5,nTotJur,nTotAbat
	Enddo

	If mv_par19 == 1
		aBkSRes:=aClone(aSRes)
		aSRes:={}
		If nOrdem == 4
			For nX:=1 to len(aBkSRes)
				If aBkSRes[nX,1] == "AN"
					nP:=nX+1
					lIncluiu_1:=.f.
					While nP <=len(aBkSRes)
						If aBkSRes[nP,1]=="AN"
								// Cliente Igual                                 Data de Vencimento Igual
							If aBkSRes[nP,2,1,5] == aBkSRes[nX,2,1,5] .and. aBkSRes[nP,2,7,4] == aBkSRes[nX,2,7,4]
								if !lIncluiu_1
									aAdd(aSRes,aBkSRes[nX])
									lIncluiu_1:=.t.
								EndIf
								aAdd(aSRes,aBkSRes[nP])
							Else
								If !lIncluiu_1
									aAdd(aSRes,aBkSRes[nX])
								EndIf
								nP-=2
								exit
							EndIf
						ElseIf aBkSRes[nP,1]=="TM"
							if !lIncluiu_1
								aAdd(aSRes,aBkSRes[nX])
								lIncluiu_1:=.t.
								exit
							EndIf
						EndIf
						nP+=1
					EndDo
					nX++
					If !lIncluiu_1
						aAdd(aSRes,aBkSRes[nX])
						nX++
					EndIf
					nPos:=len(aSRes)
					lIncluiu_1:=.f.
					lSomou:=.f.
					lInsTD:=.f.
					For nY:=nX to nP+1
						If nY > len(aBkSRes)
							exit
						EndIf
						cTipo:=aBkSRes[nY,1]
						If !(cTipo $ ("TD|TM|AN"))
	 						If !lIncluiu_1
								aAdd(aSRes,aBkSRes[nY])							
								nPos++
								lIncluiu_1:=.t.
							Else
								aSRes[nPos, 3]+=aBkSRes[nY, 3]
								aSRes[nPos, 4]+=aBkSRes[nY, 4]
								aSRes[nPos, 5]+=aBkSRes[nY, 5]
								aSRes[nPos, 6]+=aBkSRes[nY, 6]
								aSRes[nPos, 7]+=aBkSRes[nY, 7]
								aSRes[nPos,10]+=aBkSRes[nY,10]
								lSomou:=.t.
							EndIf
						ElseIf cTipo $("TD|TM")
							aAdd(aSRes,aBkSRes[nY])
							lInsTD:=.t.
						EndIf
					Next nY
					If lSomou .and. lInsTD
						nX:=nP+1
					ElseIf !lSomou .and. !lInsTD
						nX--
					ElseIf lSomou .and. !lInsTD
						If aBkSRes[nY,2,1,1] == "AN"
							nX:=nY-1
						Else
							nX+=2
						EndIf
					EndIf
				EndIf
			Next nX
		EndIf
	EndIf

	If nOrdem == 4
		For nX:=1 to len(aSRes)
			If aSRes[nX,1] == "TD" //.and. aSRes[nX,1] != "TM" .and. aSRes[nX,1] != "AN"
				For nY:=1 to nX-1
					If aSRes[nY,1] != "TD" .and. aSRes[nY,1] != "TM" .and. aSRes[nY,1] != "AN"
						If aSRes[nY,2] == aSRes[nX,2]
							aSRes[nX,3]+=aSRes[nY,3]
							aSRes[nX,4]+=aSRes[nY,4]
							aSRes[nX,5]+=aSRes[nY,5]
							aSRes[nX,6]+=aSRes[nY,6]
							aSRes[nX,7]+=aSRes[nY,7]
							aSRes[nX,10]+=aSRes[nY,10]
						EndIf
					EndIf
				Next nY
			EndIf
		Next nX
    EndIf
	If nOrdem == 11
		If mv_par19 == 1 // analitico
			aBkGrp:=aClone(aGrupo)
			aGrupo:={};aGrupo:=array(20,0)
			aAN:={}
			aSubT:={}
			For nX:=1 to len(aBkGrp)
				If alltrim(str(nX)) $ cGrupo
					cBkFilial:=""
					aSomaFil:=array(3);aSomaFil[1]:=0;aSomaFil[2]:=0;aSomaFil[3]:=0
					aSomaGrp:=array(3);aSomaGrp[1]:=0;aSomaGrp[2]:=0;aSomaGrp[3]:=0
					If aBkGrp[nX,1,1,1] == "AN"
//						cBkFilial:=substr(aBkGrp[nX,1,1,5],len(aBkGrp[1,1,1,5])-1,2)
						cBkFilial:=substr(aBkGrp[nX,1,1,5],len(aBkGrp[nX,1,1,5])-1,2)
					EndIf
					For nY:=1 to len(abkGrp[nX])
						If len(aBkGrp[nX,nY]) >12  //AN
						    //      Se Proxima filial nao for igual aGrupo[nX,nY,1,5] guarda CodCliente+Loja+Filial
							If cBkFilial !=substr(aBkGrp[nX,nY,1,5],len(aBkGrp[nX,nY,1,5])-1,2)
								aAdd(aGrupo[nX],{"TF",cBkFilial,aSomaFil[1],aSomaFil[2],aSomaFil[3],0,0,nOrdem,0,0,nDecs})
								aSomaFil:=array(3);aSomaFil[1]:=0;aSomaFil[2]:=0;aSomaFil[3]:=0
								aSomaFil[1]:=aBkGrp[nX,nY, 9,4]
								aSomaFil[2]:=aBkGrp[nX,nY,10,4]
								aSomaFil[3]:=aBkGrp[nX,nY,11,4]
								aAdd(aGrupo[nX],aBkGrp[nX,nY])
							Else
								aAdd(aGrupo[nX],aBkGrp[nX,nY])
								aSomaFil[1]+=aBkGrp[nX,nY, 9,4]
								aSomaFil[2]+=aBkGrp[nX,nY,10,4]
								aSomaFil[3]+=aBkGrp[nX,nY,11,4]
							EndIf
							aSomaGrp[1]+=aBkGrp[nX,nY, 9,4]
							aSomaGrp[2]+=aBkGrp[nX,nY, 9,4]
							aSomaGrp[3]+=aBkGrp[nX,nY, 9,4]
							cBkFilial:=substr(aBkGrp[nX,nY,1,5],len(aBkGrp[nX,nY,1,5])-1,2)
						Else
							aAdd(aGrupo[nX],aBkGrp[nX,nY])
						EndIf
					Next nY
				   //	cBkFilial:=substr(aBkGrp[nX,nY,1,5],len(aBkGrp[nX,nY,1,5])-1,2)
					aAdd(aGrupo[nX],{"TF",cBkFilial,aSomaFil[1],aSomaFil[2],aSomaFil[3],0,0,nOrdem,0,0,nDecs})
					aAdd(aGrupo[nX],{"TG","",aSomaGrp[1],aSomaGrp[2],aSomaGrp[3],0,0,nOrdem,0,0,nDecs})
				EndIf
			Next nX
		Else
			aBkGrp:=aClone(aGrupo)
			aGrupo:=array(20,0)
			cBkFilial:=""
			cTCliente:=""
			cTFilial:=""
			cBkCliente:=""
			dTVto:=ctod("  /  /  ")
			dBkVto:=ctod("  /  /  ")
			aTotFil:={0,0,0}
			aTotCli:={0,0,0}
			aTotGrp:={0,0,0}
			nTGeral1:=0
			nTGeral2:=0
			nTGeral3:=0
			For nX:= 1 to len(aBkGrp)
				If alltrim(str(nX)) $ cGrupo
					aAdd(aGrupo[nX],{"GRP",nX,0,0,0,0,0,nOrdem,0,0,nDecs})
					aTotGrp:={0,0,0}
					aTotFil:={0,0,0}
					aTotCli:={0,0,0}
					For nY:=1 to len(aBkGrp[nX])
						If nY == 1
							aAdd(aGrupo[nX],{"CLI",aBkGrp[nX,nY,13],0,0,0,0,0,nOrdem,0,0,nDecs})
							aTotCli:={0,0,0}
						EndIf
						cBkCliente:=cTCliente
						cTCliente:=aBkGrp[nX,nY,13]

				 		cBkFilial:=cTFilial
						cTFilial:=aBkGrp[nX,nY,1]
						
						dBkVto:=aBkGrp[nX,nY,2]
						dTVto:=dBkVto
						If aBkGrp[nX,nY,1] == "TF"
							aTotGrp[1]+=aBkGrp[nX,nY,3]
							aTotGrp[2]+=aBkGrp[nX,nY,4]
							aTotGrp[3]+=aBkGrp[nX,nY,5]
						EndIf
						If cTCliente != cBkCliente
							If nY > 1
								If cTFilial != cBkFilial
									aAdd(aGrupo[nX],{"TF",cBkFilial,aTotFil[1],aTotFil[2],aTotFil[3],0,0,nOrdem,0,0,nDecs})
								EndIf
		    					aAdd(aGrupo[nX],{"TC",cBkFilial,aTotCli[1],aTotCli[2],aTotCli[3],0,0,nOrdem,0,0,nDecs})
								aAdd(aGrupo[nX],{"CLI",aBkGrp[nX,nY,13],0,0,0,0,0,nOrdem,0,0,nDecs})
		    				EndIf
							aAdd(aGrupo[nX],aBkGrp[nX,nY])
//							aTotGrp[1]+=aTotCli[1]
//							aTotGrp[2]+=aTotCli[2]
//							aTotGrp[3]+=aTotCli[3]
							aTotCli:={0,0,0}
							aTotCli[1]+=aBkGrp[nX,nY,3]
							aTotCli[2]+=aBkGrp[nX,nY,4]
							aTotCli[3]+=aBkGrp[nX,nY,5]

							If cTFilial != cBkFilial
								aTotFil:={0,0,0}
							EndIf
							aTotFil[1]+=aBkGrp[nX,nY,3]
							aTotFil[2]+=aBkGrp[nX,nY,4]
							aTotFil[3]+=aBkGrp[nX,nY,5]
						ElseIf cTCliente == cBkCliente .and. cTFilial !=cBkFilial
							If aGrupo[nX,len(aGrupo[nX]),1] == "TF"
								aAdd(aGrupo[nX],aBkGrp[nX,nY])
		    					aAdd(aGrupo[nX],{"TF",cBkFilial,aTotFil[1],aTotFil[2],aTotFil[3],0,0,nOrdem,0,0,nDecs})
							Else
		    					aAdd(aGrupo[nX],{"TF",cBkFilial,aTotFil[1],aTotFil[2],aTotFil[3],0,0,nOrdem,0,0,nDecs})
								aAdd(aGrupo[nX],aBkGrp[nX,nY])
		    				EndIf

							aTotFil:={0,0,0}
							aTotCli[1]+=aBkGrp[nX,nY,3]
							aTotCli[2]+=aBkGrp[nX,nY,4]
							aTotCli[3]+=aBkGrp[nX,nY,5]

							aTotFil[1]+=aBkGrp[nX,nY,3]
							aTotFil[2]+=aBkGrp[nX,nY,4]
							aTotFil[3]+=aBkGrp[nX,nY,5]
						ElseIf cTCliente == cBkCliente .and. cTFilial ==cBkFilial
							If dTVto != dBkVto
								aAdd(aGrupo[nX],aBkGrp[nX,nY])
							Else
								aGrupo[nX,len(aGrupo[nX]),3]+=aBkGrp[nX,nY,3]
								aGrupo[nX,len(aGrupo[nX]),4]+=aBkGrp[nX,nY,4]
								aGrupo[nX,len(aGrupo[nX]),5]+=aBkGrp[nX,nY,5]
							EndIf
							aTotCli[1]+=aBkGrp[nX,nY,3]
							aTotCli[2]+=aBkGrp[nX,nY,4]
							aTotCli[3]+=aBkGrp[nX,nY,5]

							aTotFil[1]+=aBkGrp[nX,nY,3]
							aTotFil[2]+=aBkGrp[nX,nY,4]
							aTotFil[3]+=aBkGrp[nX,nY,5]
						EndIf
					Next nY
					If Empty(cBkFilial)
						cBkFilial:=cTFilial
					EndIf
					aAdd(aGrupo[nX],{"TF",cBkFilial,aTotFil[1],aTotFil[2],aTotFil[3],0,0,nOrdem,0,0,nDecs})
					aAdd(aGrupo[nX],{"TC",cBkFilial,aTotCli[1],aTotCli[2],aTotCli[3],0,0,nOrdem,0,0,nDecs})
					aAdd(aGrupo[nX],{"TG","",0,0,0,0,0,nOrdem,0,0,nDecs})
					nT1:=0
					nT2:=0
					nT3:=0
                    For nY:=1 to len(aGrupo[nX])
                   		If aGrupo[nX,nY,1] == "TC"
                   			nT1+=aGrupo[nX,nY,3]
                   			nT2+=aGrupo[nX,nY,4]
                   			nT3+=aGrupo[nX,nY,5]
                   		EndIf
                    Next nY
                    aGrupo[nX,len(aGrupo[nX]),3]:=nT1
                    aGrupo[nX,len(aGrupo[nX]),4]:=nT2
                    aGrupo[nX,len(aGrupo[nX]),5]:=nT3
					nTGeral1+=nT1
					nTGeral2+=nT2
					nTGeral3+=nT3
				EndIf
			Next nX
		EndIf
	EndIf

	If nOrdem == 4    
		cTipo:=""
		cBkTipo:=""
		for nX:=1 to len(aSRes)
			cBkTipo:=cTipo
			cTipo:=ALLTRIM(aSRes[nX,1])
			If cBkTipo == "AN" .and. cTipo == "AN"
				li++
			endIf

			If cTipo == "AN"

				IF li > 58 .and. mv_par19 == 1
					nAtuSM0 := SM0->(Recno())
					SM0->(dbGoto(nRegSM0))
					cabec(titulo,cabec1,cabec2,nomeprog,tamanho,GetMv("MV_COMP"))
					SM0->(dbGoTo(nAtuSM0))
				EndIF

				For nAN:=1 to len(aSRes[nX,2])
					nCol:=aSRes[nX,2,nAN,3]
					If nCol == 181
						@ li,aSRes[nX,2,nAN,3] PSAY aSRes[nX,2,nAN,4] PICTURE PesqPict("SE1","E1_JUROS",10,MV_PAR15)
					ElseIf nCol == 101
						@ li,aSRes[nX,2,nAN,3] PSAY aSRes[nX,2,nAN,4] PICTURE PesqPict("SE1","E1_VALOR",14,MV_PAR15)
					ElseIf nCol == 149
						@ li,aSRes[nX,2,nAN,3] PSAY aSRes[nX,2,nAN,4] PICTURE TM(nSaldo,14,nDecs)
					ElseIf nCol == 133
						@ li,aSRes[nX,2,nAN,3] PSAY aSRes[nX,2,nAN,4] PICTURE TM(nSaldo+nJuros,14,nDecs)
					ElseIf nCol == 116
						@ li,aSRes[nX,2,nAN,3] PSAY aSRes[nX,2,nAN,4] PICTURE TM(nSaldo,14,nDecs)
					Else
						@ li,aSRes[nX,2,nAN,3] PSAY aSRes[nX,2,nAN,4]
					EndIf
				Next nAN
			ElseIf cTipo == "TD"
						//(nDiaTot0   ,nDiaTot1   ,nDiaTot2   ,nDiaTot3   ,nDiaTot4   ,nDiaTTit   ,nDiaTotJ    ,nDecs)
				ImpTDia130(aSRes[nX,3],aSRes[nX,4],aSRes[nX,5],aSRes[nX,6],aSRes[nX,7],aSRes[nX,2],aSRes[nX,10],aSRes[nX,11])
			ElseIf cTipo == "TM"
				ImpMes130(aSRes[nX,3],aSRes[nX,4],aSRes[nX,5],aSRes[nX,6],aSRes[nX,7],aSRes[nX,8],aSRes[nX,9],aSRes[nX,10])
			Else
				cBkFilial:=aSRes[nX,1]
				cCarAnt:=aSRes[nX,2]
						// (nTit0      ,nTit1      ,nTit2      ,nTit3      ,nTit4      ,nOrdem     ,cCarAnt    ,nTotJur     ,nDecs)
				u_SubTot130(aSRes[nX,3],aSRes[nX,4],aSRes[nX,5],aSRes[nX,6],aSRes[nX,7],aSRes[nX,8],aSRes[nX,9],aSRes[nX,10],aSRes[nX,11])
			EndIf
		next
    ElseIf nOrdem == 11
		If mv_par19 == 1 // Analitico
			cTipo:=""
			cBkTipo:=""
			for nX:=1 to len(aGrupo)
				If alltrim(str(nX)) $ cGrupo
					// Imprimir aqui o nome do grupo
					IF li > 58 .and. mv_par19 == 1
						nAtuSM0 := SM0->(Recno())
						SM0->(dbGoto(nRegSM0))
						cabec(titulo,cabec1,cabec2,nomeprog,tamanho,GetMv("MV_COMP"))
						SM0->(dbGoTo(nAtuSM0))
					EndIF
					If nX == 1
						@ li,0 PSAY "FORA GRUPO"
					ElseIf nX == 2
						@ li,0 PSAY "GRUPO PSA"
					ElseIf nX == 3
						@ li,0 PSAY "GRUPO GEFCO"
					ElseIf nX == 4
						@ li,0 PSAY "EMPRESAS DO GRUPO"
					EndIf
/*
					If nX >= 1 .and. nX <= 4
						@ li,0 PSAY "FORA GRUPO"
					ElseIf nX == 5
						@ li,0 PSAY "GRUPO PSA"
					ElseIf nX == 6
						@ li,0 PSAY "GRUPO GEFCO"
					ElseIf nX == 9
						@ li,0 PSAY "EMPRESAS DO GRUPO"
					EndIf
*/
					li++
					cTFilial:=substr(aBkGrp[nX,1,1,5],len(aBkGrp[nX,1,1,5])-1,2)
					@li,0 PSAY "FILIAL - "+cTFilial+": "+Alltrim(Posicione("SM0",1,cEmpAnt+cTFilial,"M0_FILIAL"))
					li++
					For nY:=1 to len(aGrupo[nX])
						If len(aGrupo[nX,nY]) >=12  //AN
							cBkTipo:=cTipo
							cTipo:=ALLTRIM(aGrupo[nX,nY,1,1])
							If cBkTipo == "AN" .and. cTipo == "AN"
								li++
							endIf
					
							If cTipo == "AN"
					
								IF li > 58 .and. mv_par19 == 1
									nAtuSM0 := SM0->(Recno())
									SM0->(dbGoto(nRegSM0))
									cabec(titulo,cabec1,cabec2,nomeprog,tamanho,GetMv("MV_COMP"))
									SM0->(dbGoTo(nAtuSM0))
								EndIF
					
								For nAN:=1 to len(aGrupo[nX,nY])
									nCol:=aGrupo[nX,nY,nAN,3]
									If nCol == 181
										@ li,aGrupo[nX,nY,nAN,3] PSAY aGrupo[nX,nY,nAN,4] PICTURE PesqPict("SE1","E1_JUROS",10,MV_PAR15)
									ElseIf nCol == 101
										@ li,aGrupo[nX,nY,nAN,3] PSAY aGrupo[nX,nY,nAN,4] PICTURE PesqPict("SE1","E1_VALOR",14,MV_PAR15)
									ElseIf nCol == 149
										@ li,aGrupo[nX,nY,nAN,3] PSAY aGrupo[nX,nY,nAN,4] PICTURE TM(nSaldo,14,nDecs)
									ElseIf nCol == 133
										@ li,aGrupo[nX,nY,nAN,3] PSAY aGrupo[nX,nY,nAN,4] PICTURE TM(nSaldo+nJuros,14,nDecs)
									ElseIf nCol == 116
										@ li,aGrupo[nX,nY,nAN,3] PSAY aGrupo[nX,nY,nAN,4] PICTURE TM(nSaldo,14,nDecs)
									Else
										@ li,aGrupo[nX,nY,nAN,3] PSAY aGrupo[nX,nY,nAN,4]
									EndIf
								Next nAN
							EndIf
						Else
							cBkTipo:=cTipo
							cTipo:=ALLTRIM(aGrupo[nX,nY,1])
	
							If cTipo == "TF"
								cBkFilial:=aGrupo[nX,nY,2]
								li++
								ImpFil130(aGrupo[nX,nY,4],aGrupo[nX,nY,5],aGrupo[nX,nY,6],aGrupo[nX,nY,7],aGrupo[nX,nY,2],aGrupo[nX,nY,10],aGrupo[nX,nY,11])
	
								If ALLTRIM(aGrupo[nX,nY+1,1]) != "TG"
									cTFilial:=substr(aGrupo[nX,nY+1,1,5],len(aGrupo[nX,nY+1,1,5])-1,2)
									@li,0 PSAY "FILIAL - "+cTFilial+": "+Alltrim(Posicione("SM0",1,cEmpAnt+cTFilial,"M0_FILIAL"))
									li++
								EndIf
								
							ElseIf cTipo == "TG"
								ImpTGrp130(aGrupo[nX,nY,3],aGrupo[nX,nY,4],aGrupo[nX,nY,5],aGrupo[nX,nY,6],aGrupo[nX,nY,7],aGrupo[nX,nY,2],aGrupo[nX,nY,10],aGrupo[nX,nY,11])
							Else
								cBkFilial:=aGrupo[nX,nY,1]
								cCarAnt:=aGrupo[nX,nY,2]
								u_SubTot130(aGrupo[nX,nY,3],aGrupo[nX,nY,4],aGrupo[nX,nY,5],aGrupo[nX,nY,6],aGrupo[nX,nY,7],aGrupo[nX,nY,8],aGrupo[nX,nY,9],aGrupo[nX,nY,10],aGrupo[nX,nY,11])
	                        EndIf
						EndIf
					Next nY
				EndIf
			next
		Else // Sintetico
			cTipo:=""
			cBkTipo:=""

			for nX:=1 to len(aGrupo)
				If alltrim(str(nX)) $ cGrupo
					// Imprimir aqui o nome do grupo
					IF li > 58
						nAtuSM0 := SM0->(Recno())
						SM0->(dbGoto(nRegSM0))
						cabec(titulo,cabec1,cabec2,nomeprog,tamanho,GetMv("MV_COMP"))
						SM0->(dbGoTo(nAtuSM0))
					EndIF
					If nX == 1
						@ li,0 PSAY "FORA GRUPO"
					ElseIf nX == 2
						@ li,0 PSAY "GRUPO PSA"
					ElseIf nX == 3
						@ li,0 PSAY "GRUPO GEFCO"
					ElseIf nX == 4
						@ li,0 PSAY "EMPRESAS DO GRUPO"
					EndIf

/*
					If nX >= 1 .and. nX <= 4
						@ li,0 PSAY "FORA GRUPO"
					ElseIf nX == 5
						@ li,0 PSAY "GRUPO PSA"
					ElseIf nX == 6
						@ li,0 PSAY "GRUPO GEFCO"
					ElseIf nX == 9
						@ li,0 PSAY "EMPRESAS DO GRUPO"
					EndIf
*/
					li++
					For nY:=1 to len(aGrupo[nX])
							cBkTipo:=cTipo
							cTipo:=ALLTRIM(aGrupo[nX,nY,1])
	
							If cTipo == "CLI"
//								@li,0 PSAY Posicione("SA1",1,xFilial("SA1")+aGrupo[nX,nY,2],"A1_NOME")
//								li++
							ElseIf cTipo == "TF"
								cBkFilial:=aGrupo[nX,nY,2]
								ImpFil130(aGrupo[nX,nY,4],aGrupo[nX,nY,5],aGrupo[nX,nY,6],aGrupo[nX,nY,7],aGrupo[nX,nY,2],aGrupo[nX,nY,10],aGrupo[nX,nY,11])
							ElseIf cTipo == "TC"
//								ImpTCli130(aGrupo[nX,nY,3],aGrupo[nX,nY,4],aGrupo[nX,nY,5],aGrupo[nX,nY,6],aGrupo[nX,nY,7],aGrupo[nX,nY,2],aGrupo[nX,nY,10],aGrupo[nX,nY,11])
							ElseIf cTipo == "TG"
								ImpTGrp130(aGrupo[nX,nY,3],aGrupo[nX,nY,4],aGrupo[nX,nY,5],aGrupo[nX,nY,6],aGrupo[nX,nY,7],aGrupo[nX,nY,2],aGrupo[nX,nY,10],aGrupo[nX,nY,11])
							ElseIf cTipo !="GRP"
								cBkFilial:=aGrupo[nX,nY,1]
								cCarAnt:=aGrupo[nX,nY,2]
								u_SubTot130(aGrupo[nX,nY,3],aGrupo[nX,nY,4],aGrupo[nX,nY,5],aGrupo[nX,nY,6],aGrupo[nX,nY,7],aGrupo[nX,nY,8],aGrupo[nX,nY,9],aGrupo[nX,nY,10],aGrupo[nX,nY,11])
	                        EndIf
					Next nY
				EndIf
			next
		EndIf
    EndIf
	dbSelectArea("SE1")		// voltar para alias existente, se nao, nao funciona
	
	//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
	//³ Imprimir TOTAL por filial somente quan-³
	//³ do houver mais do que 1 filial.        ³
	//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
//	if mv_par21 == 1 .and. SM0->(Reccount()) > 1
//		ImpFil130(nTotFil0,nTotFil1,nTotFil2,nTotFil3,nTotFil4,nTotFiltit,nTotFilJ,nDecs)
//	Endif
	Store 0 To nTotFil0,nTotFil1,nTotFil2,nTotFil3,nTotFil4,nTotFilTit,nTotFilJ
	If Empty(xFilial("SE1"))
//		Exit
		RETURN
	Endif
	
	#IFDEF TOP
		dbSelectArea("SE1")
		dbCloseArea()
		ChKFile("SE1")
		dbSelectArea("SE1")
		dbSetOrder(1)
	#ENDIF
	
//	dbSelectArea("SM0")
//	dbSkip()
//Enddo

SM0->(dbGoTo(nRegSM0))
cFilAnt := SM0->M0_CODFIL
IF li != 80
	IF li > 58
		cabec(titulo,cabec1,cabec2,nomeprog,tamanho,GetMv("MV_COMP"))
	EndIF
	TotGer130(nTot0,nTot1,nTot2,nTot3,nTot4,nTotTit,nTotJ,nDecs)
	Roda(cbcont,cbtxt,"G")
EndIF

Set Device To Screen

#IFNDEF TOP
	dbSelectArea("SE1")
	dbClearFil()
	RetIndex( "SE1" )
	If !Empty(cIndexSE1)
		FErase (cIndexSE1+OrdBagExt())
	Endif
	dbSetOrder(1)
#ELSE
	dbSelectArea("SE1")
	dbCloseArea()
	ChKFile("SE1")
	dbSelectArea("SE1")
	dbSetOrder(1)
#ENDIF

If aReturn[5] = 1
	Set Printer TO
	dbCommitAll()
	Ourspool(wnrel)
Endif
MS_FLUSH()

Return

/*/
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡„o	 ³SubTot130 ³ Autor ³ Paulo Boschetti 		  ³ Data ³ 01.06.92 ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡„o ³Imprimir SubTotal do Relatorio										  ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Sintaxe e ³ SubTot130()																  ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Parametros³																				  ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso 	    ³ Generico																	  ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
/*/
User Function SubTot130(nTit0,nTit1,nTit2,nTit3,nTit4,nOrdem,cCarAnt,nTotJur,nDecs)

Local cCarteira := " "
DEFAULT nDecs := Msdecimais(mv_par15)

If mv_par19 == 1
	li++
EndIf
IF li > 58
	nAtuSM0 := SM0->(Recno())
	SM0->(dbGoto(nRegSM0))
	cabec(titulo,cabec1,cabec2,nomeprog,tamanho,GetMv("MV_COMP"))
	SM0->(dbGoTo(nAtuSM0))
EndIF

If nOrdem == 1
	@li,000 PSAY IIF(mv_par29 == 1,Substr(SA1->A1_NREDUZ,1,40),Substr(SA1->A1_NOME,1,40))+" "+SA1->A1_DDD+"-"+Transform(SA1->A1_TEL, "@R 9999-9999") + " "+ STR0054 + Right(cCarAnt,2)+Iif(mv_par21==1,STR0055+cFilAnt + " - " + Alltrim(SM0->M0_FILIAL),"") //"Loja - "###" Filial - "
	@li,000 PSAY IIF(mv_par29 == 1,Substr(SA1->A1_NREDUZ,1,40),Substr(SA1->A1_NOME,1,40))+" "+SA1->A1_DDD+"-"+Transform(SA1->A1_TEL, "@R 9999-9999") + " "+ STR0054 + Right(cCarAnt,2)+Iif(mv_par21==1,STR0055+cBkFilial + " - " + Alltrim(Posicione("SM0",1,cEmpAnt+cBkFilial,"M0_FILIAL")),"") //"Loja - "###" Filial - "
Elseif nOrdem == 4 .or. nOrdem == 6 
	@li,000 PSAY OemToAnsi(STR0037)  // "S U B - T O T A L ----> "
	@li,028 PSAY cCarAnt
//	@li,PCOL()+2 PSAY Iif(mv_par21=1,cBkFilial+ " - " + Alltrim(Posicione("SM0",1,cEmpAnt+cBkFilial,"M0_FILIAL")),"  ")
//	cTmp:=Posicione("SA1",1,xFilial("SA1")+cCarAnt,"A1_NREDUZ")
	cTmp:=Iif(mv_par21=1,cBkFilial+ " - " + Alltrim(Posicione("SM0",1,cEmpAnt+cBkFilial,"M0_FILIAL")),"  ")
	@li,PCOL()+2 PSAY cTmp
ElseIf nOrdem == 11
	@li,000 PSAY OemToAnsi(STR0037)  // "S U B - T O T A L ----> "
	@li,028 PSAY cCarAnt
//	@li,PCOL()+2 PSAY Iif(mv_par21=1,cBkFilial+ " - " + Alltrim(Posicione("SM0",1,cEmpAnt+cBkFilial,"M0_FILIAL")),"  ")
	cTmp:=Posicione("SA1",1,xFilial("SA1")+cCarAnt,"A1_NREDUZ")
	cTmp+=Iif(mv_par21=1,cBkFilial+ " - " + Alltrim(Posicione("SM0",1,cEmpAnt+cBkFilial,"M0_FILIAL")),"  ")
	@li,PCOL()+2 PSAY cTmp
Elseif nOrdem == 3
	@li,000 PSAY OemToAnsi(STR0037)  // "S U B - T O T A L ----> "
	@li,028 PSAY Iif(Empty(SA6->A6_NREDUZ),OemToAnsi(STR0029),SA6->A6_NREDUZ) + " " + Iif(mv_par21==1,cBkFilial+ " - " + Alltrim(Posicione("SM0",1,cEmpAnt+cBkFilial,"M0_FILIAL")),"")
ElseIf nOrdem == 5
	dbSelectArea("SED")
	dbSeek(cFilial+cCarAnt)
	@li,000 PSAY OemToAnsi(STR0037)  // "S U B - T O T A L ----> "
	@li,028 PSAY cCarAnt + " "+Substr(ED_DESCRIC,1,50) + " " + Iif(mv_par21==1,cBkFilial+ " - " + Alltrim(Posicione("SM0",1,cEmpAnt+cBkFilial,"M0_FILIAL")),"")
	dbSelectArea("SE1")
Elseif nOrdem == 7
	@li,000 PSAY OemToAnsi(STR0037)  // "S U B - T O T A L ----> "
	@li,028 PSAY SubStr(cCarAnt,7,2)+"/"+SubStr(cCarAnt,5,2)+"/"+SubStr(cCarAnt,3,2)+" - "+SubStr(cCarAnt,9,3) + " " +Iif(mv_par21==1,cBkFilial+ " - " + Alltrim(Posicione("SM0",1,cEmpAnt+cBkFilial,"M0_FILIAL")),"")
ElseIf nOrdem == 8
	@li,000 PSAY SA1->A1_COD+" "+Substr(SA1->A1_NOME,1,40)+" "+SA1->A1_DDD+"-"+Transform(SA1->A1_TEL, "@R 9999-9999")+ " " + Iif(mv_par21==1,cBkFilial+ " - " + Alltrim(Posicione("SM0",1,cEmpAnt+cBkFilial,"M0_FILIAL")),"")
ElseIf nOrdem == 9
	cCarteira := Situcob(cCarAnt)
	@li,000 PSAY SA6->A6_COD+" "+SA6->A6_NREDUZ + SubStr(cCarteira,1,2) + " "+SubStr(cCarteira,3,20) + " " + Iif(mv_par21==1,cBkFilial+ " - " + Alltrim(Posicione("SM0",1,cEmpAnt+cBkFilial,"M0_FILIAL")),"")
Endif
If mv_par19 == 1
	@li,101 PSAY nTit0		  Picture TM(nTit0,14,nDecs)
Endif
@li,116 PSAY nTit1		  Picture TM(nTit1,14,nDecs)
@li,133 PSAY nTit2		  Picture TM(nTit2,14,nDecs)
@li,149 PSAY nTit3		  Picture TM(nTit3,14,nDecs)
If nTotJur > 0
	@li,179 PSAY nTotJur  Picture TM(nTotJur,12,nDecs)
Endif
@li,204 PSAY nTit2+nTit3 Picture TM(nTit2+nTit3,16,nDecs)
li++
If (nOrdem == 1 .Or. nOrdem == 8) .And. mv_par35 == 1 // Salta pag. por cliente
	cabec(titulo,cabec1,cabec2,nomeprog,tamanho,GetMv("MV_COMP"))
Endif
Return .T.

/*/
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡„o	 ³ TotGer130³ Autor ³ Paulo Boschetti       ³ Data ³ 01.06.92 ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡„o ³ Imprimir total do relatorio										  ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Sintaxe e ³ TotGer130()																  ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Parametros³																				  ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso      ³ Generico																	  ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
/*/
STATIC Function TotGer130(nTot0,nTot1,nTot2,nTot3,nTot4,nTotTit,nTotJ,nDecs)

DEFAULT nDecs := Msdecimais(mv_par15)

li++
IF li > 58
	nAtuSM0 := SM0->(Recno())
	SM0->(dbGoto(nRegSM0))
	cabec(titulo,cabec1,cabec2,nomeprog,tamanho,GetMv("MV_COMP"))
	SM0->(dbGoTo(nAtuSM0))
EndIF

@li,000 PSAY OemToAnsi(STR0038) //"T O T A L   G E R A L ----> " + " " + Iif(mv_par21==1,cFilAnt,"")
@li,028 PSAY "("+ALLTRIM(STR(nTotTit))+" "+IIF(nTotTit > 1,OemToAnsi(STR0039),OemToAnsi(STR0040))+")"		//"TITULOS"###"TITULO"
If mv_par19 == 1
	@li,101 PSAY nTot0		  Picture TM(nTot0,14,nDecs)
Endif
@li,116 PSAY nTot1		  Picture TM(nTot1,14,nDecs)
@li,133 PSAY nTot2		  Picture TM(nTot2,14,nDecs)
@li,149 PSAY nTot3		  Picture TM(nTot3,14,nDecs)
@li,179 PSAY nTotJ		  Picture TM(nTotJ,12,nDecs)
@li,204 PSAY nTot2+nTot3 Picture TM(nTot2+nTot3,16,nDecs)
li++
li++
Return .T.

/*/
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡„o	 ³ImpMes130 ³ Autor ³ Vinicius Barreira	  ³ Data ³ 12.12.94 ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡„o ³IMPRIMIR TOTAL DO RELATORIO - QUEBRA POR MES					  ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Sintaxe e ³ ImpMes130() 															  ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Parametros³ 																			  ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso		 ³ Generico 																  ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
/*/
STATIC Function ImpMes130(nMesTot0,nMesTot1,nMesTot2,nMesTot3,nMesTot4,nMesTTit,nMesTotJ,nDecs)

DEFAULT nDecs := Msdecimais(mv_par15)
li++
IF li > 58
	nAtuSM0 := SM0->(Recno())
	SM0->(dbGoto(nRegSM0))
	cabec(titulo,cabec1,cabec2,nomeprog,tamanho,GetMv("MV_COMP"))
	SM0->(dbGoTo(nAtuSM0))
EndIF
@li,000 PSAY OemToAnsi(STR0041)  //"T O T A L   D O  M E S ---> "
@li,028 PSAY "("+ALLTRIM(STR(nMesTTit))+" "+IIF(nMesTTit > 1,OemToAnsi(STR0039),OemToAnsi(STR0040))+")"  //"TITULOS"###"TITULO"
If mv_par19 == 1
	@li,101 PSAY nMesTot0   Picture TM(nMesTot0,14,nDecs)
Endif
@li,116 PSAY nMesTot1	Picture TM(nMesTot1,14,nDecs)
@li,133 PSAY nMesTot2	Picture TM(nMesTot2,14,nDecs)
@li,149 PSAY nMesTot3	Picture TM(nMesTot3,14,nDecs)
@li,179 PSAY nMesTotJ	Picture TM(nMesTotJ,12,nDecs)
@li,204 PSAY nMesTot2+nMesTot3 Picture TM(nMesTot2+nMesTot3,16,nDecs)
li+=2
Return(.T.)


STATIC Function ImpTDia130(nDiaTot0,nDiaTot1,nDiaTot2,nDiaTot3,nDiaTot4,nDiaTTit,nDiaTotJ,nDecs)

DEFAULT nDecs := Msdecimais(mv_par15)
//li++
IF li > 58
	nAtuSM0 := SM0->(Recno())
	SM0->(dbGoto(nRegSM0))
	cabec(titulo,cabec1,cabec2,nomeprog,tamanho,GetMv("MV_COMP"))
	SM0->(dbGoTo(nAtuSM0))
EndIF
@li,000 PSAY "T O T A L   D O  D I A"
@li,028 PSAY nDiaTTit
If mv_par19 == 1
	@li,101 PSAY nDiaTot0   Picture TM(nDiaTot0,14,nDecs)
Endif
@li,116 PSAY nDiaTot1	Picture TM(nDiaTot1,14,nDecs)
@li,133 PSAY nDiaTot2	Picture TM(nDiaTot2,14,nDecs)
@li,149 PSAY nDiaTot3	Picture TM(nDiaTot3,14,nDecs)
@li,179 PSAY nDiaTotJ	Picture TM(nDiaTotJ,12,nDecs)
@li,204 PSAY nDiaTot2+nDiaTot3 Picture TM(nDiaTot2+nDiaTot3,16,nDecs)
li+=2
Return(.T.)

STATIC Function ImpTGrp130(nDiaTot0,nDiaTot1,nDiaTot2,nDiaTot3,nDiaTot4,nDiaTTit,nDiaTotJ,nDecs)

DEFAULT nDecs := Msdecimais(mv_par15)
//li++
IF li > 58
	nAtuSM0 := SM0->(Recno())
	SM0->(dbGoto(nRegSM0))
	cabec(titulo,cabec1,cabec2,nomeprog,tamanho,GetMv("MV_COMP"))
	SM0->(dbGoTo(nAtuSM0))
EndIF
//           "T O T A L   D O  D I A"
@li,000 PSAY "TOTAL  D O   G R U P O"
//@li,028 PSAY nDiaTTit
If mv_par19 == 1
	@li,101 PSAY nDiaTot0   Picture TM(nDiaTot0,14,nDecs)
Endif
@li,116 PSAY nDiaTot1	Picture TM(nDiaTot1,14,nDecs)
@li,133 PSAY nDiaTot2	Picture TM(nDiaTot2,14,nDecs)
@li,149 PSAY nDiaTot3	Picture TM(nDiaTot3,14,nDecs)
@li,179 PSAY nDiaTotJ	Picture TM(nDiaTotJ,12,nDecs)
@li,204 PSAY nDiaTot2+nDiaTot3 Picture TM(nDiaTot2+nDiaTot3,16,nDecs)
li+=2

Return(.T.)

STATIC Function ImpTCli130(nDiaTot0,nDiaTot1,nDiaTot2,nDiaTot3,nDiaTot4,nDiaTTit,nDiaTotJ,nDecs)

DEFAULT nDecs := Msdecimais(mv_par15)
//li++
IF li > 58
	nAtuSM0 := SM0->(Recno())
	SM0->(dbGoto(nRegSM0))
	cabec(titulo,cabec1,cabec2,nomeprog,tamanho,GetMv("MV_COMP"))
	SM0->(dbGoTo(nAtuSM0))
EndIF
//           "T O T A L   D O  D I A"
@li,000 PSAY "TOTAL  D O  CLIENTE   "
//@li,028 PSAY nDiaTTit
If mv_par19 == 1
	@li,101 PSAY nDiaTot0   Picture TM(nDiaTot0,14,nDecs)
Endif
@li,116 PSAY nDiaTot1	Picture TM(nDiaTot1,14,nDecs)
@li,133 PSAY nDiaTot2	Picture TM(nDiaTot2,14,nDecs)
@li,149 PSAY nDiaTot3	Picture TM(nDiaTot3,14,nDecs)
@li,179 PSAY nDiaTotJ	Picture TM(nDiaTotJ,12,nDecs)
@li,204 PSAY nDiaTot2+nDiaTot3 Picture TM(nDiaTot2+nDiaTot3,16,nDecs)
li+=2

Return(.T.)

/*/
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡„o	 ³ ImpFil130³ Autor ³ Paulo Boschetti  	  ³ Data ³ 01.06.92 ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡„o ³ Imprimir total do relatorio										  ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Sintaxe e ³ ImpFil130()																  ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Parametros³																				  ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso 	    ³ Generico																	  ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
/*/
STATIC Function ImpFil130(nTotFil0,nTotFil1,nTotFil2,nTotFil3,nTotFil4,nTotFilTit,nTotFilJ,nDecs)

DEFAULT nDecs := Msdecimais(mv_par15)

//li++
IF li > 58
	nAtuSM0 := SM0->(Recno())
	SM0->(dbGoto(nRegSM0))
	cabec(titulo,cabec1,cabec2,nomeprog,tamanho,GetMv("MV_COMP"))
	SM0->(dbGoTo(nAtuSM0))
EndIF
@li,000 PSAY OemToAnsi(STR0043)+" "+Iif(mv_par21==1,cBkFilial+" - " + AllTrim(Posicione("SM0",1,cEmpAnt+cBkFilial,"M0_FILIAL")),"")  //"T O T A L   F I L I A L ----> "
If mv_par19 == 1
	@li,101 PSAY nTotFil0        Picture TM(nTotFil0,14,nDecs)
Endif
@li,116 PSAY nTotFil1        Picture TM(nTotFil1,14,nDecs)
@li,133 PSAY nTotFil2        Picture TM(nTotFil2,14,nDecs)
@li,149 PSAY nTotFil3        Picture TM(nTotFil3,14,nDecs)
@li,179 PSAY nTotFilJ		  Picture TM(nTotFilJ,12,nDecs)
@li,204 PSAY nTotFil2+nTotFil3 Picture TM(nTotFil2+nTotFil3,16,nDecs)
li+=2
Return .T.

/*/
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡„o	 ³fr130Indr ³ Autor ³ Wagner           	  ³ Data ³ 12.12.94 ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡„o ³Monta Indregua para impressao do relat¢rio						  ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso		 ³ Generico 																  ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
/*/
User Function fr130IndR()
Local cString

//cString := 'E1_FILIAL=="'+xFilial("SE1")+'".And.'
cString := 'E1_CLIENTE>="'+mv_par01+'".and.E1_CLIENTE<="'+mv_par02+'".And.'
cString += 'E1_PREFIXO>="'+mv_par03+'".and.E1_PREFIXO<="'+mv_par04+'".And.'
cString += 'E1_NUM>="'+mv_par05+'".and.E1_NUM<="'+mv_par06+'".And.'
cString += 'DTOS(E1_VENCREA)>="'+DTOS(mv_par09)+'".and.DTOS(E1_VENCREA)<="'+DTOS(mv_par10)+'".And.'
cString += '(E1_MULTNAT == "1" .OR. (E1_NATUREZ>="'+mv_par11+'".and.E1_NATUREZ<="'+mv_par12+'")).And.'
cString += 'DTOS(E1_EMISSAO)>="'+DTOS(mv_par13)+'".and.DTOS(E1_EMISSAO)<="'+DTOS(mv_par14)+'"'
If !Empty(mv_par31) // Deseja imprimir apenas os tipos do parametro 31
	cString += '.And.E1_TIPO$"'+mv_par31+'"'
ElseIf !Empty(Mv_par32) // Deseja excluir os tipos do parametro 32
	cString += '.And.!(E1_TIPO$'+'"'+mv_par32+'")'
EndIf
IF mv_par34 == 1  // Apenas titulos que estarao no fluxo de caixa
	cString += '.And.(E1_FLUXO!="N")'	
Endif
Return cString

/*/
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡…o    ³ PutDtBase³ Autor ³ Mauricio Pequim Jr    ³ Data ³ 18/07/02 ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡…o ³ Acerta parametro database do relatorio                     ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Uso       ³ Finr130.prx                                                ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
/*/
Static Function PutDtBase()
Local _sAlias	:= Alias()

dbSelectArea("SX1")
dbSetOrder(1)
If MsSeek("GFI13036")
	//Acerto o parametro com a database
	RecLock("SX1",.F.)
	Replace x1_cnt01		With "'"+DTOC(dDataBase)+"'"
	MsUnlock()	
Endif

dbSelectArea(_sAlias)
Return

/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍ»±±
±±ºPrograma  ³AjustaSX1 ºAutor  ³Mauricio Pequim Jr. º Data ³29.12.2004   º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDesc.     ³Insere novas perguntas ao sx1                               º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºUso       ³ FINR130                                                    º±±
±±ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/
Static Function AjustaSX1()

Local aHelpPor	:= {}
Local aHelpEng	:= {}
Local aHelpSpa	:= {}
					  
Aadd( aHelpPor, 'Selecione "Sim" para que sejam         '  )
Aadd( aHelpPor, 'considerados no relatório, títulos cuja'  )
Aadd( aHelpPor, 'emissão seja em data posterior a database' )
Aadd( aHelpPor, 'do relatório, ou "Não" em caso contrário'  )

Aadd( aHelpSpa, 'Seleccione "Sí" para que se consideren en'	)
Aadd( aHelpSpa, 'el informe los títulos cuya emisión sea en')
Aadd( aHelpSpa, 'fecha posterior a la fecha base de dicho '	)
Aadd( aHelpSpa, 'informe o "No" en caso contrario'	)

Aadd( aHelpEng, 'Choose "Yes" for bills which issue date '	)
Aadd( aHelpEng, 'is posterior to the report base date in ' 	)
Aadd( aHelpEng, 'the report, otherwise "No"' 			)

PutSx1( "GFI130", "38","Tit. Emissao Futura?","Tit.Emision Futura  ","Future Issue Bill   ","mv_chs","N",1,0,2,"C","","","","","mv_par38","Sim","Si","Yes","","Nao","No","No","","","","","","","","","",aHelpPor,aHelpEng,aHelpSpa)

Return


/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍ»±±
±±ºPrograma  ³Situcob   ºAutor  ³Mauricio Pequim Jr. º Data ³13.04.2005   º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDesc.     ³Retorna situacao de cobranca do titulo                      º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºUso       ³ FINR130                                                    º±±
±±ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/
Static Function SituCob(cCarAnt)

Local aSituaca := {}
Local aArea		:= GetArea()
Local cCart		:= " "

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Monta a tabela de situa‡”es de T¡tulos										 ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
dbSelectArea("SX5")
dbSeek(cFilial+"07")
While SX5->X5_FILIAL+SX5->X5_tabela == cFilial+"07"
	cCapital := Capital(X5Descri())
	AADD( aSituaca,{SubStr(SX5->X5_CHAVE,1,2),OemToAnsi(SubStr(cCapital,1,20))})
	dbSkip()
EndDo

nOpcS := (Ascan(aSituaca,{|x| Alltrim(x[1])== Substr(cCarAnt,4,1) }))
If nOpcS > 0
	cCart := aSituaca[nOpcS,1]+aSituaca[nOpcs,2]		
ElseIf Empty(SE1->E1_SITUACA)
	cCart := "0 "+STR0029
Endif
RestArea(aArea)
Return cCart
